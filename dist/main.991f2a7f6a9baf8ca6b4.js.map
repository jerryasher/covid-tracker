{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/main.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","isTouchDevice","document","documentElement","$","body","addClass","mapDataPromise","countyDataPromise","stateDataPromise","stateData","countyData","usData","lastData","stateFeatures","stateBorders","countyFeatures","filters","state","field","time","useLog","per100k","consistentY","firstCasesDate","Date","lastCasesDate","tooltipValue","tooltipShown","tooltipHideTimer","isTestingData","dataPointLabels","cases","deaths","tests","positive","pending","negative","newCases","newDeaths","newTests","newPositive","newNegative","pop","keys","forEach","k","per100kKey","mapDataPointLabels","indexOf","replace","timeLabels","all","countyLabelToFips","populationOverrides","fipsRemapping","filterKeys","filterDefaults","parseQs","qs","query","substring","vars","split","obj","map","decodeURIComponent","v","router","hist","this","history","listen","parse","fetchAndRenderStates","fetchAndRenderCounties","location","search","qsKey","undefined","val","prop","show","hide","_update","action","encodeURIComponent","join","getValueKeys","withTesting","valueKeys","processStates","csv","testingCsv","byFips","nestedStates","d3","entries","testingByFips","date","year","String","month","fips","Number","coerceNumber","total","positiveIncrease","negativeIncrease","totalTestResultsIncrease","forFips","getTime","console","error","popMap","processPopulations","processGroups","aggNytKeys","aggTestKeys","usValues","testsByDate","stateValuesAtDate","values","usValuesAtDate","dates","stateValueAtDate","usValueAtDate","usRawData","usRawTesting","assign","parseInt","groups","testingMap","group","newValues","prevRow","row","county","parsed","testing","positivePct","negativePct","pendingPct","newPositivePct","newNegativePct","p100kFactor","noPopulation","filterData","datesToShow","hasTestingData","extents","extentKeys","concat","g","valuesIndex","extent","filterGridData","memoizeOne","filterOverviewData","mapRenderCount","render","daysToShow","b","a","utc1","utc2","overview","isCounties","stateFips","UTC","getFullYear","getMonth","getDate","Math","floor","_MS_PER_DAY","nextDate","setDate","unshift","gridData","overviewData","options","$overview","node","getBoundingClientRect","width","height","$cell","select","selectAll","remove","useLarge","innerWidth","yAxisWidth","chartWidth","chartHeight","attr","renderCharts","allowDrilldown","barPad","renderOverview","$svg","chartPadding","estChartWidth","numCols","numStates","xAxisHeight","winWidth","colWidth","rowHeight","numRows","ceil","totalHeight","sortVal","lastVal","findLast","sort","enter","append","each","numColsForRow","range","col","classed","renderGrid","_mapRenderCount","then","us","topojson","objects","states","features","counties","fetchMapData","$map","mapWidth","mapHeight","projection","translate","scale","path","fieldTitle","timeTitle","text","$g","countyFeaturesFiltered","_stateFips","filter","f","id","stateFeaturesFiltered","hasMapData","Boolean","style","joinedData","hasTests","fields","label","newPending","feature","aggMapData","domain","min","colorScale","scaleCluster","mapColors","fillColor","datum","mapNoDataColor","clusters","$item","update","exit","css","formatNumNice","renderMapLegend","$states","transition","duration","isFirstMapRender","$counties","$features","onMouseEnter","evt","showTooltip","title","subtitle","fieldLabels","$backdrop","on","setStateFilter","stopPropagation","hideTooltipSoon","$gSel","bounds","xWidth","yHeight","xCenter","yCenter","max","renderMap","reverse","yScaleType","xScale","rangeRound","paddingInner","paddingOuter","barWidth","bandwidth","barXMidpoints","makeYScale","extentMin","nice","makeAxis","domainMax","numTicks","ticks","tickSizeInner","tickSizeOuter","tickFormat","yScale","yAxis","$cells","counter","index","stackFields","cellYScale","cellYAxis","stack","y","isNaN","$crosshair","$hover","onMouseMove","onClick","xPos","bisectIndex","left","right","abs","find","chPos","round","toLocaleString","day","formatTooltipDate","scrollTo","arr","endDate","startDate","formatXDate","clearTimeout","pageX","pageY","clientY","top","bottom","transform","winHeight","innerHeight","bodyHeight","fitsLeft","fitsRight","fitsTop","fitsBottom","dataPoints","hasPercents","columnClass","color","pct","dp","suffix","formatter","formatPer100kValue","dataPointEl","format","formatTooltipValue","dpValue","pctFmt","drilldownMsg","toggleClass","html","setTimeout","hideTooltip","removeClass","precision","abbrev","parseFloat","toPrecision","tooltipFmtPer100k","tooltipFmtPer100kSmall","tooltipFmt","selector","el","querySelector","scrollIntoView","behavior","block","resizeWindow","throttle","fetchCountyData","Promise","stateMap","countyPop","byCounty","countiesForState","addEventListener","stateOptions","localeCompare","change","click","is"],"mappings":"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","file":"main.991f2a7f6a9baf8ca6b4.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"Vtdi\",1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import * as d3 from 'd3';\nimport scaleCluster from 'd3-scale-cluster';\nimport memoizeOne from 'memoize-one';\nimport throttle from 'lodash/throttle';\nimport findLast from 'lodash/findLast';\nimport $ from 'jquery';\nimport * as history from 'history';\nimport * as topojson from 'topojson-client';\nimport './style.css';\n\n(function () {\n  const isTouchDevice = 'ontouchstart' in document.documentElement;\n  if (isTouchDevice) {\n    $(document.body).addClass('touch');\n  }\n\n  // Data\n  let stateData = null;\n  let countyData = null;\n  let usData = null;\n  let lastData = null;\n\n  // Map features\n  let stateFeatures = null;\n  let stateBorders = null;\n  let countyFeatures = null;\n\n  // Filter values\n  const filters = {\n    state: 'all',\n    field: 'newCases',\n    time: '14d',\n    useLog: false,\n    per100k: false,\n    consistentY: true,\n  };\n\n  // UI state\n  let firstCasesDate = new Date(2020, 0, 21);\n  let lastCasesDate = null;\n  let tooltipValue = null;\n  let tooltipShown = null;\n  let tooltipHideTimer = null;\n  let isTestingData = false;\n\n  let mapDataPromise;\n  let countyDataPromise;\n  let stateDataPromise;\n\n  ///////////////\n  // Constants //\n  ///////////////\n\n  const dataPointLabels = {\n    cases: 'Total Cases',\n    deaths: 'Total Deaths',\n    tests: 'Total Tests',\n    positive: 'Total Positive',\n    pending: 'Total Pending',\n    negative: 'Total Negative',\n    newCases: 'New Cases',\n    newDeaths: 'New Deaths',\n    newTests: 'New Tests',\n    newPositive: 'New Positive',\n    newNegative: 'New Negative',\n    pop: 'Est. Population',\n  };\n  Object.keys(dataPointLabels).forEach((k) => {\n    dataPointLabels[per100kKey(k)] = dataPointLabels[k];\n  });\n\n  // On the map, \"daily new\" fields are averages\n  const mapDataPointLabels = {...dataPointLabels};\n  Object.keys(mapDataPointLabels).forEach((key) => {\n    if (key.indexOf('new') === 0) {\n      mapDataPointLabels[key] = `Avg ${mapDataPointLabels[key].replace('New', 'Daily')}`;\n    }\n  });\n\n  const timeLabels = {\n    '7d': 'Last 7 days',\n    '14d': 'Last 14 days',\n    '1mo': 'Last 30 days',\n    all: 'All-time',\n  };\n\n  const KANSAS_CITY_FAKE_FIPS = '29999';\n\n  // https://github.com/nytimes/covid-19-data#geographic-exceptions\n  const countyLabelToFips = {\n    'New York City': '36061',\n    'Kansas City': KANSAS_CITY_FAKE_FIPS,\n  };\n\n  const populationOverrides = {\n    // Kansas City, MO edge cases. City is not a real county, it overlaps\n    // with four other counties. Mayor posted a tweet with population estimates\n    // for the non-city portion of these counties:\n    // https://twitter.com/QuintonLucasKC/status/1249756319805997058\n    [KANSAS_CITY_FAKE_FIPS]: 505604,\n    // Cass County, MO\n    '29037': 85,\n    // Jackson County, MO\n    '29095': 313870,\n    // Clay County, MO\n    '29047': 137446,\n    // Platte County, MO\n    '29165': 54202,\n\n    // New York City - Sum of the 5 boroughs due to NYT geographic exception\n    '36061': 8336817,\n  };\n\n  const fipsRemapping = {\n    // Bronx -> NY\n    '36005': '36061',\n    // Kings -> NY,\n    '36047': '36061',\n    // Queens -> NY\n    '36081': '36061',\n    // Richmond -> NY\n    '36085': '36061',\n  };\n\n  ////////////\n  // Router //\n  ////////////\n\n  const filterKeys = {\n    state: 'state',\n    field: 'field',\n    time: 'time',\n    useLog: 'log',\n    per100k: 'per100k',\n    consistentY: 'consistentY',\n  };\n  const filterDefaults = {\n    state: 'all',\n    field: 'newCases',\n    time: '14d',\n    useLog: false,\n    per100k: false,\n    consistentY: true,\n  };\n\n  class Router {\n    constructor(hist) {\n      this.history = hist;\n      this.history.listen(() => {\n        // Update filter state variables and re-render\n        this.parse();\n        if (filters.state === 'all') {\n          fetchAndRenderStates();\n        } else {\n          fetchAndRenderCounties(filters.state);\n        }\n      });\n    }\n\n    parse() {\n      const qs = parseQs(this.history.location.search);\n      const keys = Object.keys(filterKeys);\n\n      for (let i = 0; i < keys.length; i++) {\n        const k = keys[i];\n        const qsKey = filterKeys[k];\n        let v = qs[qsKey] != undefined ? qs[qsKey] : filterDefaults[k];\n        // Coerce boolean filter values from string to boolean\n        if (typeof filterDefaults[k] === 'boolean' && typeof v === 'string') {\n          v = v === '1';\n        }\n        if (filters[k] === v) {\n          continue;\n        }\n        switch (k) {\n          case 'state': {\n            // Somehow URLs with plus instead of space are being used\n            v = v.replace('+', ' ');\n            filters.state = v;\n            $('#state-select').val(v);\n            break;\n          }\n          case 'field': {\n            if (dataPointLabels[v]) {\n              filters.field = v;\n              $('#field-select').val(v);\n\n              isTestingData = filters.field === 'tests' || filters.field === 'newTests';\n              if (isTestingData) {\n                // Disable useLog if switching to testing data\n                filters.useLog = false;\n                $('#cb-use-log-scale').prop('checked', false);\n                qs[filterKeys.useLog] = '0';\n\n                $('.testing-legend').show();\n                $('#filter-use-log-scale').hide();\n              } else {\n                $('.testing-legend').hide();\n                $('#filter-use-log-scale').show();\n              }\n            }\n            break;\n          }\n          case 'time': {\n            filters.time = v;\n            $('#time-select').val(v);\n            break;\n          }\n          case 'useLog': {\n            filters.useLog = v;\n            $('#cb-use-log-scale').prop('checked', v);\n            break;\n          }\n          case 'per100k': {\n            filters.per100k = v;\n            $('#cb-per-100k').prop('checked', v);\n            break;\n          }\n          case 'consistentY': {\n            filters.consistentY = v;\n            $('#cb-consistent-y').prop('checked', v);\n            break;\n          }\n        }\n      }\n    }\n\n    push(obj) {\n      this._update('push', obj);\n    }\n\n    replace(obj) {\n      this._update('replace', obj);\n    }\n\n    _update(action, obj) {\n      const query = {\n        ...parseQs(this.history.location.search),\n        ...obj,\n      };\n      this.history[action]({\n        search: stringifyQs(query),\n      });\n    }\n  }\n\n  function parseQs(qs) {\n    const query = qs[0] === '?' ? qs.substring(1) : qs;\n    const vars = query ? query.split('&') : [];\n    const obj = {};\n    for (let i = 0; i < vars.length; i++) {\n      const [k, v] = vars[i].split('=').map(decodeURIComponent);\n      obj[k] = v;\n    }\n    return obj;\n  }\n  function stringifyQs(obj) {\n    const result = Object.keys(obj)\n      .map((k) => {\n        return `${encodeURIComponent(k)}=${encodeURIComponent(obj[k])}`;\n      })\n      .join('&');\n    return result ? `?${result}` : '';\n  }\n  const router = new Router(history.createBrowserHistory());\n  router.parse();\n\n  /////////////////////\n  // Data Processing //\n  /////////////////////\n\n  function getValueKeys(withTesting) {\n    const valueKeys = ['cases', 'deaths', 'newCases', 'newDeaths'];\n    if (withTesting) {\n      valueKeys.push(\n        'positive',\n        'negative',\n        'pending',\n        'tests',\n        'newPositive',\n        'newNegative',\n        'newTests',\n      );\n    }\n    return valueKeys;\n  }\n\n  function processStates(csv, pop, testingCsv) {\n    const nestedStates = d3\n      .nest()\n      .key((k) => k.state)\n      .entries(csv);\n\n    const testingByFips = processTestingData(testingCsv);\n\n    const popMap = processPopulations(pop);\n    stateData = processGroups(nestedStates, popMap, testingByFips);\n\n    const [usRawData, usRawTesting] = processUS(csv, testingByFips);\n    usData = processGroups(usRawData, popMap, usRawTesting);\n  }\n\n  function processUS(csv, testingByFips) {\n    const aggNytKeys = ['cases', 'deaths'];\n    const aggTestKeys = [\n      'positive',\n      'negative',\n      'pending',\n      'tests',\n      'newPositive',\n      'newNegative',\n      'newTests',\n    ];\n\n    // Nest by date (easier to aggregate)\n    const nested = d3\n      .nest()\n      .key((k) => k.date)\n      .entries(csv);\n\n    const usValues = nested.map((n) => {\n      const stateValuesAtDate = n.values;\n      const usValuesAtDate = {\n        fips: '00',\n        date: stateValuesAtDate[0].date,\n      };\n      stateValuesAtDate.forEach((state) => {\n        aggNytKeys.forEach((key) => {\n          if (!usValuesAtDate[key]) {\n            usValuesAtDate[key] = 0;\n          }\n          usValuesAtDate[key] += Number(state[key]);\n        });\n      });\n      return usValuesAtDate;\n    });\n\n    // Aggregate testing data\n    const testsByDate = {};\n    Object.keys(testingByFips).forEach((fips) => {\n      const dates = testingByFips[fips];\n      Object.keys(dates).forEach((date) => {\n        if (!testsByDate[date]) {\n          testsByDate[date] = {};\n        }\n        const stateValueAtDate = dates[date];\n        const usValueAtDate = testsByDate[date];\n        aggTestKeys.forEach((key) => {\n          if (!usValueAtDate[key]) {\n            usValueAtDate[key] = 0;\n          }\n          usValueAtDate[key] += stateValueAtDate[key] || 0;\n        });\n      });\n    });\n\n    return [[{key: 'United States', values: usValues}], {'00': testsByDate}];\n  }\n\n  function processTestingData(csv) {\n    const byFips = {};\n    csv.forEach((c) => {\n      if (!c.date) {\n        return;\n      }\n      const year = String(c.date).substring(0, 4);\n      const month = String(c.date).substring(4, 6);\n      const date = String(c.date).substring(6, 8);\n      const fips = c.fips;\n\n      const value = {\n        fips: fips || '',\n        date: new Date(Number(year), Number(month) - 1, Number(date)),\n        positive: coerceNumber(c.positive),\n        negative: coerceNumber(c.negative),\n        pending: coerceNumber(c.pending),\n        tests: coerceNumber(c.total),\n        newPositive: coerceNumber(c.positiveIncrease),\n        newNegative: coerceNumber(c.negativeIncrease),\n        newTests: coerceNumber(c.totalTestResultsIncrease),\n      };\n\n      // Add to our map\n      if (!byFips[fips]) {\n        byFips[fips] = {};\n      }\n      const forFips = byFips[fips];\n      if (forFips[value.date.getTime()]) {\n        console.error(`Multiple rows for for same state fips/date`, c);\n      }\n      forFips[value.date.getTime()] = value;\n    });\n\n    return byFips;\n  }\n\n  function coerceNumber(value) {\n    return value == undefined ? null : Number(value);\n  }\n\n  function processCounties(csv, pop) {\n    // First nest counties by state\n    const nestedStates = d3\n      .nest()\n      .key((k) => k.state)\n      .entries(csv);\n\n    const stateMap = {};\n    const popMap = processPopulations(pop);\n\n    nestedStates.forEach((state) => {\n      const counties = d3\n        .nest()\n        .key((k) => k.county)\n        .entries(state.values);\n      const byCounty = processGroups(counties, popMap);\n      stateMap[state.key] = {key: state.key, counties: byCounty};\n    });\n\n    countyData = stateMap;\n  }\n\n  function processPopulations(pop) {\n    const map = Object.assign({}, populationOverrides);\n    pop.forEach((p) => {\n      const fips = fipsRemapping[p.fips] || p.fips;\n      if (populationOverrides[fips]) {\n        map[fips] = populationOverrides[fips];\n      } else {\n        map[fips] = parseInt(p.pop);\n      }\n    });\n    return map;\n  }\n\n  function processGroups(groups, popMap, testingMap) {\n    const valueKeys = getValueKeys(!!testingMap);\n\n    groups.forEach((group) => {\n      const newValues = [];\n      for (let i = 0; i < group.values.length; i++) {\n        const prevRow = group.values[i - 1];\n        const row = group.values[i];\n        const [year, month, date] = row.date.split('-');\n\n        let fips = row.fips;\n        if (!fips && row.county) {\n          fips = countyLabelToFips[row.county];\n        }\n\n        const parsed = {\n          ...row,\n          fips,\n          date: new Date(Number(year), Number(month) - 1, Number(date)),\n          cases: Number(row.cases),\n          deaths: Number(row.deaths),\n        };\n        if (prevRow) {\n          parsed.newCases = parsed.cases - prevRow.cases;\n          parsed.newDeaths = parsed.deaths - prevRow.deaths;\n        } else {\n          parsed.newCases = parsed.cases;\n          parsed.newDeaths = parsed.deaths;\n        }\n        newValues.push(parsed);\n\n        // Add in testing data\n        const testing = ((testingMap ? testingMap[parsed.fips] : {}) || {})[parsed.date.getTime()];\n        if (testing) {\n          parsed.positive = testing.positive;\n          parsed.positivePct = testing.positive / testing.tests;\n          parsed.negative = testing.negative;\n          parsed.negativePct = testing.negative / testing.tests;\n          parsed.pending = testing.pending;\n          parsed.pendingPct = testing.pending / testing.tests;\n          parsed.tests = testing.tests;\n          parsed.newPositive = testing.newPositive;\n          parsed.newPositivePct = testing.newPositive / testing.newTests;\n          parsed.newNegative = testing.newNegative;\n          parsed.newNegativePct = testing.newNegative / testing.newTests;\n          parsed.newTests = testing.newTests;\n        }\n\n        // Add population-normalized data\n        const pop = popMap[parsed.fips];\n        if (pop) {\n          parsed.pop = pop;\n          const p100kFactor = pop / 1e5;\n          valueKeys.forEach((key) => {\n            if (typeof parsed[key] === 'number') {\n              parsed[per100kKey(key)] = parsed[key] / p100kFactor;\n            }\n          });\n        } else {\n          group.noPopulation = true;\n        }\n\n        if (lastCasesDate === null || parsed.date.getTime() > lastCasesDate.getTime()) {\n          lastCasesDate = parsed.date;\n        }\n      }\n      group.values = newValues;\n    });\n\n    return groups;\n  }\n\n  function filterData(groups, datesToShow, hasTestingData) {\n    const valueKeys = getValueKeys(hasTestingData);\n\n    const extents = {};\n    const extentKeys = ['date'].concat(valueKeys).concat(valueKeys.map(per100kKey));\n    extentKeys.forEach((key) => (extents[key] = [null, null]));\n\n    const newGroups = groups.map((g) => {\n      const {values} = g;\n      const newValues = [];\n      let valuesIndex = 0;\n\n      // Get the dates we care about\n      for (var i = 0; i < datesToShow.length; i++) {\n        while (\n          values[valuesIndex] &&\n          values[valuesIndex].date.getTime() < datesToShow[i].getTime()\n        ) {\n          valuesIndex++;\n        }\n        if (\n          values[valuesIndex] &&\n          values[valuesIndex].date.getTime() === datesToShow[i].getTime()\n        ) {\n          newValues.push({...values[valuesIndex], i});\n        }\n      }\n\n      // Update the extents object\n      newValues.forEach((value) => {\n        extentKeys.forEach((key) => {\n          const extent = extents[key];\n          if (value[key] != undefined && (extent[0] === null || value[key] < extent[0])) {\n            extents[key][0] = value[key];\n          }\n          if (value[key] != undefined && (extent[1] === null || value[key] > extent[1])) {\n            extents[key][1] = value[key];\n          }\n        });\n      });\n\n      return {\n        ...g,\n        values: newValues,\n      };\n    });\n\n    return {groups: newGroups, extents};\n  }\n\n  const filterGridData = memoizeOne(filterData);\n  const filterOverviewData = memoizeOne(filterData);\n\n  function per100kKey(key) {\n    return `${key}_p100k`;\n  }\n\n  function last(arr) {\n    return arr[arr.length - 1];\n  }\n\n  let mapRenderCount = 0;\n  function render(data) {\n    lastData = data;\n    const {groups, overview, isCounties, stateFips} = data;\n\n    const field = filters.per100k ? per100kKey(filters.field) : filters.field;\n\n    let daysToShow;\n    if (filters.time === '7d') {\n      daysToShow = 7;\n    } else if (filters.time === '14d') {\n      daysToShow = 14;\n    } else if (filters.time === '1mo') {\n      daysToShow = 30;\n    } else {\n      daysToShow = dateDiffInDays(lastCasesDate, firstCasesDate);\n    }\n    const datesToShow = [lastCasesDate];\n    for (let i = 1; i < daysToShow; i++) {\n      const nextDate = new Date(lastCasesDate);\n      nextDate.setDate(lastCasesDate.getDate() - i);\n      datesToShow.unshift(nextDate);\n    }\n\n    if (isCounties && isTestingData) {\n      $('#viz').hide();\n      $('.testing-data-unavailable').show();\n      return;\n    } else {\n      $('#viz').show();\n      $('.testing-data-unavailable').hide();\n    }\n\n    const gridData = filterGridData(groups, datesToShow, !isCounties);\n    const overviewData = filterOverviewData(overview, datesToShow, true);\n\n    const options = {\n      field,\n      daysToShow,\n      datesToShow,\n      isCounties,\n      stateFips,\n    };\n\n    renderOverview(overviewData, options);\n    renderGrid(gridData, options);\n\n    // Render map after fetching map data (debounce the render calls)\n    const _mapRenderCount = ++mapRenderCount;\n    fetchMapData().then(() => {\n      if (_mapRenderCount === mapRenderCount) {\n        renderMap(gridData, options);\n      }\n    });\n  }\n\n  function aggMapData(groups, features) {\n    const byFips = {};\n\n    const hasTests = groups[0].values[0].tests != undefined;\n    const fields = getValueKeys(hasTests);\n\n    groups.forEach((group) => {\n      const {values} = group;\n      if (!values.length) {\n        return;\n      }\n      const {fips, pop} = values[0];\n\n      // Just aggregate the number of new cases/etc across the selected time range\n      let value = {\n        fips,\n        pop,\n        label: group.key,\n        // New cases/deaths over last N days\n        cases: d3.sum(values, (v) => v.newCases),\n        deaths: d3.sum(values, (v) => v.newDeaths),\n        // Average of new daily cases/deahts over last N days\n        newCases: d3.mean(values, (v) => v.newCases),\n        newDeaths: d3.mean(values, (v) => v.newDeaths),\n      };\n\n      if (hasTests) {\n        value.tests = d3.sum(values, (v) => v.newTests);\n        value.positive = d3.sum(values, (v) => v.newPositive);\n        value.positivePct = value.positive / value.tests;\n        value.negative = d3.sum(values, (v) => v.newNegative);\n        value.negativePct = value.negative / value.tests;\n        value.pending = d3.sum(values, (v) => v.newPending);\n        value.pendingPct = value.pending / value.tests;\n        value.newTests = d3.mean(values, (v) => v.newTests);\n        value.newPositive = d3.mean(values, (v) => v.newPositive);\n        value.newPositivePct = value.newPositive / value.newTests;\n        value.newNegative = d3.mean(values, (v) => v.newNegative);\n        value.newNegativePct = value.newNegative / value.newTests;\n      }\n\n      const p100kFactor = pop / 1e5;\n      fields.forEach((field) => {\n        if (typeof value[field] === 'number') {\n          value[per100kKey(field)] = value[field] / p100kFactor;\n        }\n      });\n\n      byFips[Number(fips)] = value;\n    });\n\n    return features.map((f) => {\n      const fips = fipsRemapping[f.id] || f.id;\n      const data = byFips[fips];\n      return {\n        id: f.id,\n        feature: f,\n        ...data,\n      };\n    });\n  }\n\n  // https://gka.github.io/palettes/#/7|s|49006a,9b59b6,ffd09f|ffffe0,ff005e,93003a|1|1\n  const mapColors = [\n    '#49006a',\n    '#672682',\n    '#874694',\n    '#a666a0',\n    '#c588a6',\n    '#e3aba6',\n    '#ffd09f',\n  ].reverse();\n  const mapNoDataColor = '#999';\n\n  let isFirstMapRender = true;\n  function renderMap(data, options) {\n    const {field, isCounties, stateFips} = options;\n    const {groups} = data;\n\n    const allowDrilldown = !isCounties;\n\n    const $map = d3.select('#svg-map');\n    const {width, height} = $map.node().getBoundingClientRect();\n    const mapWidth = width;\n    const mapHeight = height;\n\n    const projection = d3\n      .geoAlbersUsa()\n      .translate([mapWidth / 2, mapHeight / 2])\n      .scale(mapWidth);\n    const path = d3.geoPath().projection(projection);\n\n    const fieldTitle = mapDataPointLabels[field];\n    const timeTitle = timeLabels[filters.time];\n    d3.select('#map-title').text(`Map of ${fieldTitle}, ${timeTitle}`);\n\n    const $g = $map.select('#map-g').attr('width', mapWidth).attr('height', mapHeight);\n\n    let countyFeaturesFiltered = [];\n    if (isCounties) {\n      const _stateFips = String(Number(stateFips));\n      countyFeaturesFiltered = countyFeatures.filter((f) => {\n        const fips = String(f.id);\n        return _stateFips === fips.substring(0, fips.length === 4 ? 1 : 2);\n      });\n    }\n\n    let stateFeaturesFiltered = isCounties\n      ? stateFeatures.filter((f) => f.id === Number(stateFips))\n      : stateFeatures;\n\n    const hasMapData = Boolean(stateFeaturesFiltered.length);\n    d3.select('#map-no-data').classed('shown', !hasMapData);\n    d3.select('#viz-map-header').style('opacity', hasMapData ? 1 : 0);\n\n    const joinedData = aggMapData(\n      groups,\n      isCounties ? countyFeaturesFiltered : stateFeaturesFiltered,\n    );\n\n    const domain = [];\n    joinedData.forEach((d) => {\n      const value = d[field];\n      if (typeof value === 'number' && value > 0) {\n        domain.push(value);\n      }\n    });\n    if (domain.length === 0) {\n      domain.push(1);\n    }\n    const min = d3.min(domain);\n    const colorScale = scaleCluster().domain(domain).range(mapColors);\n    const clusters = colorScale.clusters();\n    renderMapLegend(clusters, min);\n\n    function fillColor(d) {\n      const datum = d[field];\n      return datum != undefined && datum !== 0 ? colorScale(datum) : mapNoDataColor;\n    }\n\n    const $states = $g\n      .select('#map-states')\n      .selectAll('.map-state')\n      .data(isCounties ? stateFeaturesFiltered : joinedData, (d) => d.id)\n      .join(\n        (enter) => enter.append('path').attr('opacity', 0).attr('class', 'map-state map-feat'),\n        (update) => update,\n        (exit) => {\n          exit.transition().duration(350).attr('opacity', 0).remove();\n        },\n      );\n\n    $states\n      .attr('d', (d) => path(d.feature))\n      .transition()\n      .duration(isFirstMapRender ? 0 : 350)\n      .attr('opacity', 1)\n      .attr('fill', isCounties ? mapNoDataColor : fillColor);\n\n    const $counties = $g\n      .select('#map-counties')\n      .selectAll('.map-county')\n      .data(isCounties ? joinedData : [], (d) => d.id)\n      .join(\n        (enter) =>\n          enter\n            .append('path')\n            .attr('opacity', 0)\n            .attr('class', (d) => `map-county map-county-${d.id} map-feat`),\n        (update) => update,\n        (exit) => {\n          exit.transition().duration(350).attr('opacity', 0).remove();\n        },\n      )\n      .attr('d', (d) => path(d.feature))\n      .attr('fill', fillColor);\n\n    $counties\n      .transition()\n      .duration(isFirstMapRender ? 0 : 350)\n      .attr('opacity', 1);\n\n    $g.select('#map-state-borders')\n      .datum(stateBorders)\n      .attr('d', path)\n      .attr('opacity', isCounties ? 0 : 1);\n\n    const $features = isCounties ? $counties : $states;\n\n    function onMouseEnter(d) {\n      const evt = d3.event;\n      if (d.label) {\n        showMapTooltip({value: d, field, evt, allowDrilldown: allowDrilldown && !isTestingData});\n      }\n    }\n\n    const $backdrop = d3.select('#map-backdrop');\n    $backdrop.attr('width', width).attr('height', height);\n    $backdrop.on('click', () => {\n      if (isCounties) {\n        setStateFilter('all');\n      }\n    });\n\n    if (isTouchDevice) {\n      $features\n        .on('click', (d) => {\n          // Dont let this bubble up to document click\n          d3.event.stopPropagation();\n          onMouseEnter(d);\n        })\n        .on('mouseleave', () => {\n          hideTooltipSoon();\n        });\n    } else {\n      $features\n        .on('click', (d) => {\n          if (allowDrilldown) {\n            setStateFilter(d.label);\n          } else {\n            setStateFilter('all');\n          }\n        })\n        .on('mouseenter', onMouseEnter)\n        .on('mouseleave', () => {\n          hideTooltipSoon();\n        });\n    }\n\n    // Zoom to the correct location (anaimated on subsequent renders)\n    const $gSel = isFirstMapRender ? $g : $g.transition().duration(750);\n    if (isCounties && stateFeaturesFiltered.length) {\n      const bounds = isCounties ? path.bounds(stateFeaturesFiltered[0]) : null;\n      const xWidth = bounds[1][0] - bounds[0][0];\n      const yHeight = bounds[1][1] - bounds[0][1];\n      const xCenter = (bounds[0][0] + bounds[1][0]) / 2;\n      const yCenter = (bounds[0][1] + bounds[1][1]) / 2;\n      const scale = 0.9 / Math.max(xWidth / mapWidth, yHeight / mapHeight);\n      const translate = [mapWidth / 2 - scale * xCenter, mapHeight / 2 - scale * yCenter];\n      $gSel.attr('transform', 'translate(' + translate + ')scale(' + scale + ')');\n    } else {\n      $gSel.attr('transform', 'translate(0)scale(1)');\n    }\n\n    isFirstMapRender = false;\n  }\n\n  function renderMapLegend(clusters, min) {\n    const $legend = d3.select('#map-legend');\n    $legend\n      .selectAll('.map-legend-item')\n      .data([0, min].concat(clusters))\n      .join(\n        (enter) => {\n          const $item = enter.append('div').attr('class', 'map-legend-item');\n          $item.append('div').classed('map-legend-item-label', true);\n          return $item;\n        },\n        (update) => update,\n        (exit) => exit.remove(),\n      )\n      .each(function (d, i) {\n        $(this).css('background-color', i === 0 ? mapNoDataColor : mapColors[i - 1]);\n      })\n      .select('.map-legend-item-label')\n      .text((d) => formatMapLegendTick(d));\n  }\n\n  function renderOverview(data, options) {\n    const $overview = d3.select('#svg-overview');\n    const {width, height} = $overview.node().getBoundingClientRect();\n\n    const $cell = $overview.select('g.cell');\n    $cell.selectAll('*').remove();\n\n    const useLarge = window.innerWidth >= 1024;\n    const yAxisWidth = useLarge ? 40 : 30;\n    const xAxisHeight = useLarge ? 20 : 14;\n    const marginRight = 16;\n    const chartWidth = width - yAxisWidth - marginRight;\n    const chartHeight = height - xAxisHeight;\n\n    $cell.attr('transform', `translate(${yAxisWidth}, 0)`);\n\n    renderCharts($overview, data, {\n      ...options,\n      allowDrilldown: false,\n      chartWidth,\n      chartHeight,\n      barPad: 3,\n    });\n  }\n\n  function renderGrid(data, options) {\n    const {field, daysToShow} = options;\n\n    const $svg = d3.select('#grid');\n    // Make sure  we're starting fresh\n    $svg.selectAll('*').remove();\n    $svg.attr('class', filters.consistentY ? 'consistent-y' : '');\n\n    const groups = data.groups.slice(0);\n\n    const useLarge = window.innerWidth >= 1024;\n    const chartAspectRatio = 2.15;\n    const chartPadding = useLarge ? 30 : 25;\n    const estChartWidth = useLarge ? 250 : 150;\n    const numCols = Math.floor(window.innerWidth / (estChartWidth + chartPadding));\n    const chartWidth = Math.floor((window.innerWidth - chartPadding * (numCols + 1)) / numCols);\n\n    const numStates = groups.length;\n    const chartHeight = Math.floor(chartWidth / chartAspectRatio);\n    const yAxisWidth = useLarge ? 40 : 30;\n    const xAxisHeight = useLarge ? 20 : 14;\n    const winWidth = window.innerWidth;\n    const barPad = daysToShow > 10 ? 1 : 2;\n\n    const colWidth = chartWidth + chartPadding;\n    const rowHeight = chartHeight + xAxisHeight + chartPadding;\n\n    const numRows = Math.ceil(numStates / numCols);\n\n    const totalHeight = numRows * rowHeight;\n\n    const allowDrilldown = !options.isCounties;\n\n    groups.forEach((g) => {\n      if (field.indexOf('new') === 0) {\n        // For daily new cases / deaths, sort by the sum of the data currently being shown\n        g.sortVal = d3.sum(g.values, (v) => v[field]);\n      } else {\n        // Otherwise sort by the last shown cumulative value\n        const lastVal = findLast(g.values, (v) => v[field] != undefined);\n        g.sortVal = lastVal ? lastVal[field] : -1;\n      }\n    });\n    groups.sort((a, b) => b.sortVal - a.sortVal);\n\n    // Create grid of rows and columns\n    const $rows = $svg\n      .attr('viewBox', [0, 0, winWidth, totalHeight])\n      .selectAll('g.row')\n      .data(d3.range(numRows))\n      .enter()\n      .append('g')\n      .attr('class', 'row')\n      .attr('transform', (row) => `translate(${yAxisWidth}, ${row * rowHeight})`);\n\n    // Add cells\n    $rows.each(function (row) {\n      const lastItemNumber = (row + 1) * numCols;\n      const numColsForRow = lastItemNumber > groups.length ? groups.length % numCols : numCols;\n      const range = d3.range(numColsForRow).map((i) => ({row, col: i}));\n      d3.select(this)\n        .selectAll('g.cell')\n        .data(range)\n        .enter()\n        .append('g')\n        .attr('class', 'cell')\n        .classed('cell-clickable', allowDrilldown && !isTestingData)\n        .attr('transform', (d) => `translate(${d.col * colWidth}, 0)`);\n    });\n\n    renderCharts(\n      $svg,\n      {\n        ...data,\n        groups,\n      },\n      {\n        ...options,\n        allowDrilldown,\n        chartWidth,\n        chartHeight,\n        barPad,\n      },\n    );\n  }\n\n  function renderCharts($svg, data, options) {\n    const {\n      field,\n      daysToShow,\n      datesToShow,\n      allowDrilldown,\n      chartWidth,\n      chartHeight,\n      barPad,\n    } = options;\n    const {groups, extents} = data;\n\n    const yScaleType = filters.useLog ? 'scaleLog' : 'scaleLinear';\n\n    const xScale = d3\n      .scaleBand()\n      .domain(datesToShow)\n      .rangeRound([0, chartWidth])\n      .paddingInner((barPad * daysToShow) / chartWidth)\n      .paddingOuter((barPad * 5) / chartWidth);\n    const barWidth = xScale.bandwidth();\n\n    const barXMidpoints = datesToShow.map((d) => {\n      return xScale(d) + barWidth / 2;\n    });\n\n    function makeYScale(extent) {\n      const domain = [0, Math.max(extent[1], filters.per100k ? 0.1 : 10)];\n      if (filters.useLog) {\n        const extentMin = Math.max(extent[0], 0) || (filters.per100k ? 0.01 : 1);\n        // Make sure domain start is small enough such that even really small numbers show a bar\n        domain[0] = 1;\n        while (domain[0] >= extentMin) {\n          domain[0] /= 10;\n        }\n      }\n      return d3[yScaleType]().domain(domain).range([chartHeight, 0]).nice();\n    }\n\n    function makeAxis(scale) {\n      const domainMax = scale.domain()[1];\n      let numTicks = 4;\n      if (filters.useLog) {\n        if (filters.per100k) {\n          // numTicks > 2 here can create 10+ ticks\n          numTicks = 3;\n        } else {\n          numTicks = domainMax < 100 ? 1 : domainMax < 1000 ? 2 : domainMax < 10000 ? 3 : 4;\n        }\n      }\n      // Make sure there arent too many ticks (happens particularly often with log scale + per100k)\n      while (scale.ticks(numTicks).length > 5) {\n        numTicks--;\n      }\n      return d3\n        .axisLeft(scale)\n        .ticks(numTicks)\n        .tickSizeInner(-chartWidth)\n        .tickSizeOuter(0)\n        .tickFormat((d) => {\n          return formatYTick(d);\n        });\n    }\n    const yScale = makeYScale(extents[field]);\n    const yAxis = makeAxis(yScale);\n\n    const $cells = $svg.selectAll('g.cell');\n\n    // Fill each cell with a chart\n    let counter = 0;\n    $cells.each(function (d, index) {\n      const $cell = d3.select(this);\n      const data = groups[index];\n      if (!data) {\n        return;\n      }\n      counter++;\n      const values = data.values;\n\n      // Add baseline\n      $cell\n        .append('line')\n        .attr('class', 'baseline')\n        .attr('y1', chartHeight)\n        .attr('y2', chartHeight)\n        .attr('x2', chartWidth);\n\n      // Add axis\n      let cellYScale = yScale;\n      let cellYAxis = yAxis;\n      if (!filters.consistentY) {\n        const extent = d3.extent(values, (d) => d[field]);\n        cellYScale = makeYScale(extent);\n        cellYAxis = makeAxis(cellYScale);\n      }\n\n      $cell.append('g').attr('transform', 'translate(0,0)').call(cellYAxis);\n\n      let stackFields;\n      if (isTestingData) {\n        stackFields =\n          filters.field === 'newTests' ? ['newPositive', 'newNegative'] : ['positive', 'negative'];\n        if (filters.per100k) {\n          stackFields = stackFields.map(per100kKey);\n        }\n      } else {\n        stackFields = [field];\n      }\n\n      const stack = d3.stack().keys(stackFields)(values);\n      const $layers = $cell\n        .selectAll('g.layer')\n        .data(stack, (d) => d.key)\n        .enter()\n        .append('g')\n        .attr('class', (d, i) => {\n          return `layer layer-${i + 1} layer-${d.key}`;\n        });\n\n      $layers\n        .selectAll('.bar')\n        .data(\n          (l) => l,\n          (d) => String(d.data.date.getTime()),\n        )\n        .enter()\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('width', barWidth)\n        .attr('x', (d) => xScale(d.data.date))\n        .attr('y', (d) => {\n          const y = Math.floor(cellYScale(d[1]));\n          return Number.isNaN(y) ? chartHeight : y;\n        })\n        .attr('height', (d) => {\n          const y = Math.max(Math.ceil(chartHeight - cellYScale(d[1] - d[0])), 0);\n          return Number.isNaN(y) ? 0 : y;\n        });\n\n      const $crosshair = $cell\n        .append('line')\n        .attr('y1', 0)\n        .attr('y2', chartHeight)\n        .attr('class', 'crosshair crosshair-hidden');\n\n      function onMouseMove() {\n        const evt = d3.event;\n        const mouse = d3.mouse(this);\n        const xPos = mouse[0];\n        const bisectIndex = d3.bisectLeft(barXMidpoints, xPos);\n        const left = barXMidpoints[bisectIndex - 1];\n        const right = barXMidpoints[bisectIndex];\n        const index =\n          left == undefined || Math.abs(xPos - right) < Math.abs(xPos - left)\n            ? bisectIndex\n            : bisectIndex - 1;\n        const date = datesToShow[index];\n        const value = values.find((v) => v.date.getTime() === date.getTime());\n        if (value && (value !== tooltipValue || !tooltipShown)) {\n          const chPos = Math.round(xScale(date) + barWidth / 2);\n          $crosshair.attr('x1', chPos).attr('x2', chPos).classed('crosshair-hidden', false);\n          showChartTooltip({value, field, evt, allowDrilldown: allowDrilldown && !isTestingData});\n        }\n      }\n\n      function onClick() {\n        if (allowDrilldown) {\n          setStateFilter(data.key);\n          scrollTo('#viz-overview');\n        }\n      }\n\n      const $hover = $cell\n        .append('rect')\n        .attr('class', 'pointer')\n        .attr('width', chartWidth)\n        .attr('height', chartHeight);\n\n      // Touch device events are slightly different\n      if (isTouchDevice) {\n        $hover.on('click', () => {\n          // Dont let this bubble up to document click\n          d3.event.stopPropagation();\n          onMouseMove.call(this);\n        });\n      } else {\n        $hover.on('mousemove', onMouseMove).on('click', onClick);\n      }\n      $cell.on('mouseleave', () => {\n        $crosshair.classed('crosshair-hidden', true);\n        hideTooltipSoon();\n      });\n\n      // Add label above other elements to make it clickable\n      $cell\n        .append('text')\n        .text(groups.length > 1 ? `${counter}. ${data.key}` : data.key)\n        .attr('x', 6)\n        .attr('y', 14)\n        .attr('class', 'cell-label')\n        .on('click', onClick);\n\n      if (filters.per100k && data.noPopulation) {\n        $cell\n          .append('text')\n          .text('No population data')\n          .attr('x', chartWidth / 2)\n          .attr('y', chartHeight / 2)\n          .attr('class', 'cell-label-nopop');\n      }\n    });\n\n    // Add start dates\n    const endDate = last(groups[0].values).date;\n    const startDate = new Date(endDate);\n    startDate.setDate(startDate.getDate() - daysToShow + 1);\n\n    $cells\n      .append('text')\n      .attr('class', 'x-tick x-tick-start')\n      .attr('text-anchor', 'start')\n      .attr('x', 0)\n      .attr('y', chartHeight + 4)\n      .text(formatXDate(startDate));\n\n    $cells\n      .append('text')\n      .attr('class', 'x-tick x-tick-end')\n      .attr('text-anchor', 'end')\n      .attr('x', chartWidth)\n      .attr('y', chartHeight + 4)\n      .text(formatXDate(endDate));\n  }\n\n  function showMapTooltip(options) {\n    const {value} = options;\n    showTooltip({\n      ...options,\n      title: value.label,\n      subtitle: timeLabels[filters.time],\n      fieldLabels: mapDataPointLabels,\n    });\n  }\n\n  const _MS_PER_DAY = 1000 * 60 * 60 * 24;\n  function dateDiffInDays(b, a) {\n    const utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());\n    const utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());\n    return Math.floor((utc2 - utc1) / _MS_PER_DAY);\n  }\n\n  function showChartTooltip(options) {\n    const {value} = options;\n    showTooltip({\n      ...options,\n      title: formatTooltipDate(value.date),\n      fieldLabels: dataPointLabels,\n    });\n  }\n\n  function showTooltip(options) {\n    clearTimeout(tooltipHideTimer);\n    const {value, field, evt, allowDrilldown, title, subtitle, fieldLabels} = options;\n    tooltipValue = value;\n    tooltipShown = true;\n    const pageX = evt.pageX;\n    const pageY = evt.pageY;\n    const clientY = evt.clientY;\n    const pad = 10;\n    const css = {left: '', right: '', top: '', bottom: '', transform: ''};\n    const winWidth = window.innerWidth;\n    const winHeight = window.innerHeight;\n    const bodyHeight = document.body.getBoundingClientRect().height;\n\n    const fitsLeft = pageX - 250 > 0;\n    const fitsRight = pageX + 250 < winWidth;\n    const fitsTop = clientY - 250 > 0;\n    const fitsBottom = clientY - 250 < winHeight;\n\n    if (fitsTop) {\n      css.bottom = `${bodyHeight - pageY + pad}px`;\n    } else {\n      css.top = `${pageY + pad}px`;\n    }\n\n    if (fitsRight) {\n      css.left = `${pageX + pad}px`;\n    } else if (fitsLeft) {\n      css.right = `${winWidth - pageX + pad}px`;\n    } else if (fitsTop || !fitsBottom) {\n      css.left = pageX;\n      css.transform = 'translateX(-50%)';\n      css.bottom = `${bodyHeight - pageY + pad}px`;\n    } else if (fitsBottom) {\n      css.left = pageX;\n      css.transform = 'translateX(-50%)';\n      css.top = `${pageY + pad}px`;\n    }\n\n    const hasPercents = isTestingData;\n    const columnClass = hasPercents ? 'col-3' : 'col-2';\n\n    let dataPoints;\n    if (filters.field === 'tests') {\n      dataPoints = [\n        {key: 'positive', color: 'primary1', pct: value.positivePct},\n        {key: 'negative', color: 'primary2', pct: value.negativePct},\n        {key: 'pending', pct: value.pendingPct},\n        {key: 'tests'},\n        {key: 'cases'},\n        {key: 'deaths'},\n      ];\n    } else if (filters.field === 'newTests') {\n      dataPoints = [\n        {key: 'newPositive', color: 'primary1', pct: value.newPositivePct},\n        {key: 'newNegative', color: 'primary2', pct: value.newNegativePct},\n        {key: 'newTests'},\n        {key: 'newCases'},\n        {key: 'newDeaths'},\n      ];\n    } else {\n      dataPoints = ['cases', 'deaths', 'newCases', 'newDeaths'].map((k) => ({\n        key: k,\n        color: k === field ? 'primary1' : null,\n      }));\n    }\n    if (filters.per100k) {\n      dataPoints = dataPoints.map((dp) => ({\n        ...dp,\n        key: per100kKey(dp.key),\n        suffix: ' per 100k',\n        formatter: formatPer100kValue,\n      }));\n      if (value.pop != undefined) {\n        dataPoints.push({\n          key: 'pop',\n        });\n      }\n    }\n    const dataPointEl = dataPoints.map((dp) => {\n      const format = dp.formatter || formatTooltipValue;\n      const dpValue = value[dp.key];\n      if (dpValue == undefined) {\n        return '';\n      }\n      return `\n        \t<div class=\"tooltip-dp-label ${dp.color || ''}\">${fieldLabels[dp.key]}</div>\n        \t<div class=\"tooltip-dp-val\">${format(dpValue)}${dp.suffix || ''}</div>\n          ${\n            hasPercents\n              ? `\n            <div class=\"tooltip-dp-pct\">\n              ${formatTooltipPct(dp.pct)}\n            </div>\n          `\n              : ''\n          }\n        \t`;\n    });\n\n    const drilldownMsg = allowDrilldown\n      ? '<div class=\"tooltip-drill\"><span class=\"click\">Click</span><span class=\"tap\">Tap</span><span> to see counties</span></div>'\n      : '';\n\n    $('#tooltip')\n      .addClass('shown')\n      .toggleClass('clickable', allowDrilldown)\n      .css(css)\n      .html(\n        `<div><h4>${title}</h4>\n        ${subtitle ? `<h5>${subtitle}</h5>` : ''}\n              <div class=\"tooltip-grid ${columnClass}\">\n                ${dataPointEl.join('')}\n              </div>\n              ${drilldownMsg}</div>`,\n      );\n  }\n\n  // Sometimes we want to delay hiding to allow user to click into tooltip before it hides (i.e. on mobile)\n  function hideTooltipSoon() {\n    // Long delay needed for iOS safari, otherwise tooltip hides\n    tooltipHideTimer = setTimeout(hideTooltip, isTouchDevice ? 500 : 50);\n  }\n  function hideTooltip() {\n    $('#tooltip').removeClass('shown');\n    tooltipShown = false;\n  }\n\n  function formatXDate(d) {\n    return d.toLocaleString('default', {month: 'short', day: 'numeric'});\n  }\n\n  function formatTooltipDate(d) {\n    return d.toLocaleString('default', {year: 'numeric', month: 'long', day: 'numeric'});\n  }\n\n  function formatYTick(n) {\n    const str = formatNumNice(n);\n    return str.replace(/^0\\./, '.');\n  }\n\n  function formatNumNice(n, precision) {\n    let abbrev;\n    if (n >= 1e6) {\n      n = n / 1e6;\n      abbrev = 'm';\n    } else if (n >= 1e3) {\n      n = n / 1e3;\n      abbrev = 'k';\n    }\n    if (precision !== undefined) {\n      // Need to parseFloat again to avoid scientific notation\n      n = parseFloat(n.toPrecision(precision));\n    }\n    return abbrev ? `${n}${abbrev}` : String(n);\n  }\n\n  const tooltipFmtPer100k = d3.format(',.1f');\n  const tooltipFmtPer100kSmall = d3.format(',.2f');\n  function formatPer100kValue(n) {\n    return n >= 1 ? tooltipFmtPer100k(n) : tooltipFmtPer100kSmall(n);\n  }\n\n  const tooltipFmt = d3.format(',d');\n  function formatTooltipValue(n) {\n    return tooltipFmt(n);\n  }\n\n  function formatMapLegendTick(n) {\n    return formatNumNice(n, 2);\n  }\n\n  const pctFmt = d3.format('.1%');\n  function formatTooltipPct(n) {\n    return n != undefined ? `(${pctFmt(n)})` : '';\n  }\n\n  function setStateFilter(state) {\n    router.push({[filterKeys.state]: state});\n  }\n\n  function scrollTo(selector) {\n    const el = document.querySelector(selector);\n    if (!el || !el.scrollIntoView) {\n      window.scrollTo(0, 0);\n    }\n    el.scrollIntoView({behavior: 'smooth', block: 'start'});\n  }\n\n  function attachEvents() {\n    $('#state-select').change(function () {\n      const val = $(this).val();\n      setStateFilter(val);\n    });\n    $('.back-to-states').click(function () {\n      setStateFilter('all');\n      scrollTo('#vi');\n    });\n    $('#field-select').change(function () {\n      router.push({\n        [filterKeys.field]: $(this).val(),\n      });\n    });\n    $('#time-select').change(function () {\n      router.push({[filterKeys.time]: $(this).val()});\n    });\n    $('#tooltip').click(function (evt) {\n      // Dont let this bubble up to the document.click hide event\n      evt.stopPropagation();\n      if ($(this).is('.clickable') && tooltipValue) {\n        setStateFilter(tooltipValue.state || tooltipValue.label);\n        // Scroll to top if this was a chart (not map) click\n        if (!tooltipValue.label) {\n          scrollTo('#viz-overview');\n        }\n      }\n    });\n    $('#cb-use-log-scale').change(function () {\n      const value = $(this).is(':checked');\n      router.push({[filterKeys.useLog]: value ? '1' : '0'});\n    });\n    $('#cb-per-100k').change(function () {\n      const value = $(this).is(':checked');\n      router.push({[filterKeys.per100k]: value ? '1' : '0'});\n    });\n    $('#cb-consistent-y').change(function () {\n      const value = $(this).is(':checked');\n      router.push({[filterKeys.consistentY]: value ? '1' : '0'});\n    });\n    $(document).on('click', function () {\n      hideTooltipSoon();\n    });\n  }\n\n  function renderAllStates() {\n    render({groups: stateData, overview: usData});\n    $('.back-to-states').removeClass('shown');\n    hideTooltip();\n  }\n  function renderCounties(state) {\n    const countiesForState = countyData[state];\n\n    const overviewData = stateData.filter((s) => s.key === state);\n    const stateFips = overviewData ? overviewData[0].values[0].fips : null;\n\n    render({\n      groups: countiesForState.counties,\n      overview: overviewData,\n      isCounties: true,\n      stateFips,\n    });\n\n    $('.back-to-states').addClass('shown');\n    hideTooltip();\n  }\n\n  const resizeWindow = throttle(() => {\n    if (lastData) {\n      render(lastData);\n    }\n  }, 100);\n  window.addEventListener('resize', resizeWindow);\n\n  function fetchMapData() {\n    if (!mapDataPromise) {\n      mapDataPromise = d3.json('assets/us-counties.topojson').then((us) => {\n        stateFeatures = topojson.feature(us, us.objects.states).features;\n        stateBorders = topojson.mesh(us, us.objects.states, (a, b) => a !== b);\n        countyFeatures = topojson.feature(us, us.objects.counties).features;\n      });\n    }\n    return mapDataPromise;\n  }\n\n  function fetchStateData() {\n    if (!stateDataPromise) {\n      stateDataPromise = Promise.all([\n        d3.csv('https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv'),\n        d3.csv('assets/fips-pop-sta.csv'),\n        d3.json('https://covidtracking.com/api/v1/states/daily.json'),\n      ]).then(([csv, statePop, testingData]) => {\n        processStates(csv, statePop, testingData);\n\n        // Populate state select\n        const stateOptions = stateData\n          .slice(0)\n          .sort((a, b) => a.key.localeCompare(b.key))\n          .map((s) => `<option value=\"${s.key}\">${s.key}</option>`)\n          .join('');\n        $('#state-select').html(`<option value=\"all\" selected>All States</option>${stateOptions}`);\n        if (filters.state !== 'all') {\n          $('#state-select').val(filters.state);\n        }\n      });\n    }\n    return stateDataPromise;\n  }\n\n  function fetchCountyData() {\n    if (!countyDataPromise) {\n      countyDataPromise = Promise.all([\n        d3.csv('https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv'),\n        d3.csv('assets/fips-pop-cty.csv'),\n      ]).then(([csv, countyPop]) => {\n        processCounties(csv, countyPop);\n      });\n    }\n    return countyDataPromise;\n  }\n\n  function fetchAndRenderStates() {\n    stateDataPromise.then(() => renderAllStates());\n  }\n\n  function fetchAndRenderCounties(state) {\n    Promise.all([stateDataPromise, fetchCountyData()]).then(() => renderCounties(state));\n  }\n\n  fetchStateData();\n  if (filters.state === 'all') {\n    fetchAndRenderStates();\n    // Fetch this in background so its ready immediately when they click on a county\n    setTimeout(fetchCountyData, 200);\n  } else {\n    fetchAndRenderCounties(filters.state);\n  }\n\n  attachEvents();\n})();\n"],"sourceRoot":""}