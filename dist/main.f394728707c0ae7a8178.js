!function(c){function t(t){for(var e,n,a=t[0],r=t[1],i=t[2],o=0,s=[];o<a.length;o++)n=a[o],Object.prototype.hasOwnProperty.call(u,n)&&u[n]&&s.push(u[n][0]),u[n]=0;for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(c[e]=r[e]);for(p&&p(t);s.length;)s.shift()();return f.push.apply(f,i||[]),l()}function l(){for(var t,e=0;e<f.length;e++){for(var n=f[e],a=!0,r=1;r<n.length;r++){var i=n[r];0!==u[i]&&(a=!1)}a&&(f.splice(e--,1),t=o(o.s=n[0]))}return t}var n={},u={0:0},f=[];function o(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return c[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=c,o.c=n,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="dist";var e=window.webpackJsonp=window.webpackJsonp||[],a=e.push.bind(e);e.push=t,e=e.slice();for(var r=0;r<e.length;r++)t(e[r]);var p=a;f.push(["Vtdi",1]),l()}({OMi8:function(t,e,n){},Vtdi:function(t,e,n){"use strict";n.r(e);var pt=n("VphZ"),a=n("KU4y"),dt=n.n(a),vt=n("Wwog"),r=n("DzJC"),ht=n.n(r),i=n("mVx/"),gt=n.n(i),o=n("ytg1"),mt=n.n(o),s=n("EVdn"),wt=n.n(s),yt=n("LhCv"),bt=n("0hfp");n("OMi8");function kt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function Pt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){xt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function xt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(){var t,e,W="ontouchstart"in document.documentElement;W&&wt()(document.body).addClass("touch");var w,n,a,g=null,l=null,m=null,y=null,U=null,F=null,R=null,X={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0},b=new Date(2020,0,21),k=null,M=null,A=null,x=null,B=!1,Y={cases:"Total Cases",deaths:"Total Deaths",tests:"Total Tests",positive:"Total Positive",pending:"Total Pending",negative:"Total Negative",newCases:"New Cases",newDeaths:"New Deaths",newTests:"New Tests",newPositive:"New Positive",newNegative:"New Negative",pop:"Est. Population"};Object.keys(Y).forEach(function(t){Y[Z(t)]=Y[t]});var H=Tt({},Y);Object.keys(H).forEach(function(t){0===t.indexOf("new")&&(H[t]="Avg ".concat(H[t].replace("New","Daily")))});var I=(xt(t={newCases:!0,newDeaths:!0},Z("newCases"),!0),xt(t,Z("newDeaths"),!0),t),J={"7d":"Last 7 days","14d":"Last 14 days","1mo":"Last 30 days",all:"All-time"},P={"New York City":"36061","Kansas City":"29999"},r=(xt(e={},"29999",505604),xt(e,"29037",103525),xt(e,"29095",386437),xt(e,"29047",108919),xt(e,"29165",48783),xt(e,"36061",8336817),e),K={36005:"36061",36047:"36061",36081:"36061",36085:"36061"},c={state:"state",field:"field",time:"time",useLog:"log",per100k:"per100k",consistentY:"consistentY"},u={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0};function f(t){for(var e="?"===t[0]?t.substring(1):t,n=e?e.split("&"):[],a={},r=0;r<n.length;r++){var i=kt(n[r].split("=").map(decodeURIComponent),2),o=i[0],s=i[1];a[o]=s}return a}var i=new(function(){function n(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.history=t,this.history.listen(function(){e.parse(),"all"===X.state?ut():ft(X.state)})}var t,e,a;return t=n,(e=[{key:"parse",value:function(t){for(var e=0<arguments.length&&void 0!==t&&t,n=f(this.history.location.search),a=Object.keys(c),r=0;r<a.length;r++){var i=a[r],o=c[i],s=null!=n[o]?n[o]:u[i];if("boolean"==typeof u[i]&&"string"==typeof s&&(s="1"===s),X[i]!==s||e)switch(i){case"state":s=s.replace("+"," "),X.state=s,wt()("#state-select").val(s);break;case"field":Y[s]&&(X.field=s,wt()("#field-select").val(s),(B="tests"===X.field||"newTests"===X.field)?(X.useLog=!1,wt()("#cb-use-log-scale").prop("checked",!1),n[c.useLog]="0",wt()(".testing-legend").show(),wt()("#filter-use-log-scale").hide()):(wt()(".testing-legend").hide(),wt()("#filter-use-log-scale").show()),"newCases"===s||"newDeaths"===s?(wt()(".ma-legend .legend-field-label").text(Y[s]),wt()(".ma-legend").show()):wt()(".ma-legend").hide());break;case"time":X.time=s,wt()("#time-select").val(s);break;case"useLog":X.useLog=s,wt()("#cb-use-log-scale").prop("checked",s);break;case"per100k":X.per100k=s,wt()("#cb-per-100k").prop("checked",s);break;case"consistentY":X.consistentY=s,wt()("#cb-consistent-y").prop("checked",s)}}}},{key:"push",value:function(t){this._update("push",t)}},{key:"replace",value:function(t){this._update("replace",t)}},{key:"_update",value:function(t,e){var n,a,r=Tt({},f(this.history.location.search),{},e);this.history[t]({search:(n=r,(a=Object.keys(n).map(function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n[t]))}).join("&"))?"?".concat(a):"")})}}])&&Pt(t.prototype,e),a&&Pt(t,a),n}())(yt.a());function q(t){var e=["cases","deaths","newCases","newDeaths"];return t&&e.push("positive","negative","pending","tests","newPositive","newNegative","newTests"),e}function o(t,e,n){var s,a=pt.nest().key(function(t){return t.state}).entries(t),r=(s={},n.forEach(function(t){if(t.date){var e=String(t.date).substring(0,4),n=String(t.date).substring(4,6),a=String(t.date).substring(6,8),r=t.fips,i={fips:r||"",date:new Date(Number(e),Number(n)-1,Number(a)),positive:T(t.positive),negative:T(t.negative),pending:T(t.pending),tests:T(t.total),newPositive:T(t.positiveIncrease),newNegative:T(t.negativeIncrease),newTests:T(t.totalTestResultsIncrease)};s[r]||(s[r]={});var o=s[r];o[i.date.getTime()]&&console.error("Multiple rows for for same state fips/date",t),o[i.date.getTime()]=i}}),s),i=j(e);g=O(a,i,r);var o,c,l,u,f,p,d=kt((o=t,c=r,l=["cases","deaths"],u=["positive","negative","pending","tests","newPositive","newNegative","newTests"],f=pt.nest().key(function(t){return t.date}).entries(o).map(function(t){var e=t.values,n={fips:"00",date:e[0].date};return e.forEach(function(e){l.forEach(function(t){n[t]||(n[t]=0),n[t]+=Number(e[t])})}),n}),p={},Object.keys(c).forEach(function(t){var a=c[t];Object.keys(a).forEach(function(t){p[t]||(p[t]={});var e=a[t],n=p[t];u.forEach(function(t){n[t]||(n[t]=0),n[t]+=e[t]||0})})}),[[{key:"United States",values:f}],{"00":p}]),2),v=d[0],h=d[1];m=O(v,i,h)}function T(t){return null==t?null:Number(t)}function j(t){var n=Object.assign({},r);return t.forEach(function(t){var e=K[t.fips]||t.fips;r[e]?n[e]=r[e]:n[e]=parseInt(t.pop)}),n}function O(t,v,h){var g=q(!!h);return t.forEach(function(p){for(var d=[],t=function(t){var e=p.values[t-1],n=p.values[t],a=kt(n.date.split("-"),3),r=a[0],i=a[1],o=a[2],s=n.fips;!s&&n.county&&(s=P[n.county]);var c=Tt({},n,{fips:s,date:new Date(Number(r),Number(i)-1,Number(o)),cases:Number(n.cases),deaths:Number(n.deaths)});e?(c.newCases=c.cases-e.cases,c.newDeaths=c.deaths-e.deaths):(c.newCases=c.cases,c.newDeaths=c.deaths),d.push(c);var l=((h?h[c.fips]:{})||{})[c.date.getTime()];l&&(c.positive=l.positive,c.positivePct=l.positive/l.tests,c.negative=l.negative,c.negativePct=l.negative/l.tests,c.pending=l.pending,c.pendingPct=l.pending/l.tests,c.tests=l.tests,c.newPositive=l.newPositive,c.newPositivePct=l.newPositive/l.newTests,c.newNegative=l.newNegative,c.newNegativePct=l.newNegative/l.newTests,c.newTests=l.newTests);var u=v[c.fips];if(u){var f=(c.pop=u)/1e5;g.forEach(function(t){"number"==typeof c[t]&&(c[Z(t)]=c[t]/f)})}else p.noPopulation=!0;(null===k||c.date.getTime()>k.getTime())&&(k=c.date)},e=0;e<p.values.length;e++)t(e);p.values=d}),t}function s(t,r,e){var n=q(e),a=n.concat(n.map(Z)),u=["newCases","newDeaths"];u=u.concat(u.map(Z));var f={},p=["date"].concat(a);p.forEach(function(t){return f[t]=[null,null]});var d=new Date(r[0]);d.setDate(d.getDate()-7);function v(t){return t.date.getTime()}return{groups:t.map(function(t){var e=t.values,i=[],o=r[0],n=h(r),s=new Date(d),c=mt()(e,{date:d},v),l={};u.forEach(function(t){l[t]=[]});for(var a=function(){var t=s.getTime()>=o.getTime(),n=e[c],a=n&&n.date.getTime()===s.getTime()?n:null,r={};u.forEach(function(t){var e=l[t];7===e.length&&e.shift(),a&&"number"==typeof a[t]?e.push(n[t]):e.push(0),r[V(t)]=pt.mean(e)}),t&&(a?i.push(Object.assign({},a,r)):i.push(Object.assign({date:new Date(s),fips:e[0].fips,pop:e[0].pop,state:e[0].state,county:e[0].county},r))),a&&c++,s.setDate(s.getDate()+1)};s.getTime()<=n.getTime();)a();return i.forEach(function(n){p.forEach(function(t){var e=f[t];null!=n[t]&&(null===e[0]||n[t]<e[0])&&(f[t][0]=n[t]),null!=n[t]&&(null===e[1]||n[t]>e[1])&&(f[t][1]=n[t])})}),Tt({},t,{values:i})}),extents:f}}i.parse(!0);var N=Object(vt.a)(s),D=Object(vt.a)(s);function Z(t){return"".concat(t,"_p100k")}function V(t){return"".concat(t,"_ma")}function h(t){return t[t.length-1]}var C=0;function p(t){var e,n,a,r,i,o=(y=t).groups,s=t.overview,c=t.isCounties,l=t.stateFips,u=X.per100k?Z(X.field):X.field;e="7d"===X.time?7:"14d"===X.time?14:"1mo"===X.time?30:(n=k,a=b,r=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),i=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()),Math.floor((i-r)/L));for(var f=[k],p=1;p<e;p++){var d=new Date(k);d.setDate(k.getDate()-p),f.unshift(d)}if(c&&B)return wt()("#viz").hide(),void wt()(".testing-data-unavailable").show();wt()("#viz").show(),wt()(".testing-data-unavailable").hide();var v=N(o,f,!c),h=D(s,f,!0),g={field:u,daysToShow:e,datesToShow:f,isCounties:c,stateFips:l};!function(t,e){var n=pt.select("#svg-overview"),a=n.node().getBoundingClientRect(),r=a.width,i=a.height,o=n.select("g.cell");o.selectAll("*").remove();var s=1024<=window.innerWidth,c=s?40:30,l=r-c-16,u=i-(s?20:14);o.attr("transform","translate(".concat(c,", 0)")),S(n,t,Tt({},e,{allowDrilldown:!1,chartWidth:l,chartHeight:u,cellLabelX:6,cellLabelY:0,barPad:3}))}(h,g),function(t,e){var n=e.field,a=e.daysToShow,r=pt.select("#grid");r.selectAll("*").remove(),r.attr("class",X.consistentY?"consistent-y":"");var i=t.groups.slice(0),o=1024<=window.innerWidth,s=o?30:25,c=o?40:35,l=o?250:150,u=Math.floor(window.innerWidth/(l+s)),f=Math.floor((window.innerWidth-s*(u+1))/u),p=i.length,d=Math.floor(f/2.15),v=o?40:30,h=o?20:14,g=window.innerWidth,m=10<a?1:2,w=f+s,y=d+h+c,b=Math.ceil(p/u),k=b*y,P=!e.isCounties;i.forEach(function(t){if(0===n.indexOf("new"))t.sortVal=pt.sum(t.values,function(t){return t[n]});else{var e=gt()(t.values,function(t){return null!=t[n]});t.sortVal=e?e[n]:-1}}),i.sort(function(t,e){return e.sortVal-t.sortVal}),r.attr("viewBox",[0,0,g,k]).selectAll("g.row").data(pt.range(b)).enter().append("g").attr("class","row").attr("transform",function(t){return"translate(".concat(v,", ").concat(t*y,")")}).each(function(e){var t=(e+1)*u>i.length?i.length%u:u,n=pt.range(t).map(function(t){return{row:e,col:t}});pt.select(this).selectAll("g.cell").data(n).enter().append("g").attr("class","cell").classed("cell-clickable",P&&!B).attr("transform",function(t){return"translate(".concat(t.col*w,", 0)")})}),S(r,Tt({},t,{groups:i}),Tt({},e,{allowDrilldown:P,chartWidth:f,chartHeight:d,cellLabelX:-20,cellLabelY:-10,barPad:m}))}(v,g);var m=++C;(function(){w=w||pt.json("assets/us-counties.topojson").then(function(t){U=bt.a(t,t.objects.states).features,F=bt.b(t,t.objects.states,function(t,e){return t!==e}),R=bt.a(t,t.objects.counties).features});return w})().then(function(){m===C&&function(t,e){var r=e.field,n=e.isCounties,a=e.stateFips,i=t.groups,o=!n,s=pt.select("#svg-map"),c=s.node().getBoundingClientRect(),l=c.width,u=c.height,f=l,p=u,d=pt.geoAlbersUsa().translate([f/2,p/2]).scale(f),v=pt.geoPath().projection(d),h=H[r],g=J[X.time];pt.select("#map-title").text("Map of ".concat(h,", ").concat(g));var m=s.select("#map-g").attr("width",f).attr("height",p),w=[];if(n){var y=String(Number(a));w=R.filter(function(t){var e=String(t.id);return y===e.substring(0,4===e.length?1:2)})}var b=n?U.filter(function(t){return t.id===Number(a)}):U,k=Boolean(b.length);pt.select("#map-no-data").classed("shown",!k),pt.select("#viz-map-header").style("opacity",k?1:0);var P=function(t,e){var s={},c=null!=t[0].values[0].tests,l=q(c);return t.forEach(function(t){var e=t.values;if(e.length){var n=e[0],a=n.fips,r=n.pop,i={fips:a,pop:r,label:t.key,cases:pt.sum(e,function(t){return t.newCases}),deaths:pt.sum(e,function(t){return t.newDeaths}),newCases:pt.mean(e,function(t){return t.newCases}),newDeaths:pt.mean(e,function(t){return t.newDeaths})};c&&(i.tests=pt.sum(e,function(t){return t.newTests}),i.positive=pt.sum(e,function(t){return t.newPositive}),i.positivePct=i.positive/i.tests,i.negative=pt.sum(e,function(t){return t.newNegative}),i.negativePct=i.negative/i.tests,i.pending=pt.sum(e,function(t){return t.newPending}),i.pendingPct=i.pending/i.tests,i.newTests=pt.mean(e,function(t){return t.newTests}),i.newPositive=pt.mean(e,function(t){return t.newPositive}),i.newPositivePct=i.newPositive/i.newTests,i.newNegative=pt.mean(e,function(t){return t.newNegative}),i.newNegativePct=i.newNegative/i.newTests);var o=r/1e5;l.forEach(function(t){"number"==typeof i[t]&&(i[Z(t)]=i[t]/o)}),s[Number(a)]=i}}),e.map(function(t){var e=K[t.id]||t.id,n=s[e];return Tt({id:t.id,feature:t},n)})}(i,n?w:b),T=[];P.forEach(function(t){var e=t[r];"number"==typeof e&&0<e&&T.push(e)}),0===T.length&&T.push(1);var x=pt.min(T),j=dt()().domain(T).range($);function O(t){var e=t[r];return null!=e&&0!==e?j(e):G}!function(t,e){pt.select("#map-legend").selectAll(".map-legend-item").data([0,e].concat(t)).join(function(t){var e=t.append("div").attr("class","map-legend-item");return e.append("div").classed("map-legend-item-label",!0),e},function(t){return t},function(t){return t.remove()}).each(function(t,e){wt()(this).css("background-color",0===e?G:$[e-1])}).select(".map-legend-item-label").text(function(t){return nt(t,2)})}(j.clusters(),x);var N=m.select("#map-states").selectAll(".map-state").data(n?b:P,function(t){return t.id}).join(function(t){return t.append("path").attr("opacity",0).attr("class","map-state map-feat")},function(t){return t},function(t){t.transition().duration(350).attr("opacity",0).remove()});N.attr("d",function(t){return v(t.feature)}).transition().duration(Q?0:350).attr("opacity",1).attr("fill",n?G:O);var D=m.select("#map-counties").selectAll(".map-county").data(n?P:[],function(t){return t.id}).join(function(t){return t.append("path").attr("opacity",0).attr("class",function(t){return"map-county map-county-".concat(t.id," map-feat")})},function(t){return t},function(t){t.transition().duration(350).attr("opacity",0).remove()}).attr("d",function(t){return v(t.feature)}).attr("fill",O);D.transition().duration(Q?0:350).attr("opacity",1),m.select("#map-state-borders").datum(F).attr("d",v).attr("opacity",n?0:1);var C=n?D:N;function S(t){var e,n,a=pt.event;t.label&&(n=(e={value:t,field:r,evt:a,allowDrilldown:o&&!B}).value,tt(Tt({},e,{title:n.label,subtitle:J[X.time],fieldLabels:H})))}var L=pt.select("#map-backdrop");L.attr("width",l).attr("height",u),L.on("click",function(){n&&ot("all")}),W?C.on("click",function(t){pt.event.stopPropagation(),S(t)}).on("mouseleave",function(){et()}):C.on("click",function(t){ot(o?t.label:"all")}).on("mouseenter",S).on("mouseleave",function(){et()});var E=Q?m:m.transition().duration(750);if(n&&b.length){var M=n?v.bounds(b[0]):null,A=M[1][0]-M[0][0],Y=M[1][1]-M[0][1],I=(M[0][0]+M[1][0])/2,V=(M[0][1]+M[1][1])/2,_=.9/Math.max(A/f,Y/p),z=[f/2-_*I,p/2-_*V];E.attr("transform","translate("+z+")scale("+_+")")}else E.attr("transform","translate(0)scale(1)");Q=!1}(v,g)})}var $=["#49006a","#672682","#874694","#a666a0","#c588a6","#e3aba6","#ffd09f"].reverse(),G="#999",Q=!0;function S(t,e,n){var m=n.field,a=n.daysToShow,w=n.datesToShow,y=n.allowDrilldown,b=n.chartWidth,k=n.chartHeight,P=n.cellLabelX,T=n.cellLabelY,r=n.barPad,x=e.groups,i=e.extents,o=X.useLog?"scaleLog":"scaleLinear",j=pt.scaleBand().domain(pt.range(w.length)).rangeRound([0,b]).paddingInner(r*a/b).paddingOuter(5*r/b),O=j.bandwidth(),N=w.map(function(t,e){return j(e)+O/2});function D(t){var e=[0,Math.max(t[1],X.per100k?.1:10)];if(X.useLog){var n=Math.max(t[0],0)||(X.per100k?.01:1);for(e[0]=1;e[0]>=n;)e[0]/=10}return pt[o]().domain(e).range([k,0]).nice()}function C(t){var e=t.domain()[1],n=4;for(X.useLog&&(n=X.per100k?3:e<100?1:e<1e3?2:e<1e4?3:4);5<t.ticks(n).length;)n--;return pt.axisLeft(t).ticks(n).tickSizeInner(-b).tickSizeOuter(0).tickFormat(function(t){return nt(t).replace(/^0\./,".")})}var S=D(i[m]),L=C(S),s=t.selectAll("g.cell"),E=0;s.each(function(t,e){var n=this,a=pt.select(this),r=x[e];if(r){E++;var f=r.values;a.append("line").attr("class","baseline").attr("y1",k).attr("y2",k).attr("x2",b);var i,o=S,s=L;if(!X.consistentY){var c=pt.extent(f,function(t){return t[m]});s=C(o=D(c))}a.append("g").attr("transform","translate(0,0)").call(s),B?(i="newTests"===X.field?["newPositive","newNegative"]:["positive","negative"],X.per100k&&(i=i.map(Z))):i=[m];var l=pt.stack().keys(i)(f);if(a.selectAll("g.layer").data(l,function(t){return t.key}).enter().append("g").attr("class",function(t,e){return"layer layer-".concat(e+1," layer-").concat(t.key)}).selectAll(".bar").data(function(t){return t},function(t){return String(t.data.date.getTime())}).enter().append("rect").attr("class","bar").attr("width",O).attr("x",function(t,e){return j(e)}).attr("y",function(t){var e=Math.floor(o(t[1]));return Number.isNaN(e)?k:e}).attr("height",function(t){var e=Math.max(Math.ceil(k-o(t[1]-t[0])),0);return Number.isNaN(e)?0:e}),I[m]){var u=O/2,p=pt.line().x(function(t,e){return Math.round(j(e)+u)}).y(function(t){var e=Math.min(Math.floor(o(t[V(m)])),k);return Number.isNaN(e)?k:e}).curve(pt.curveMonotoneX);a.append("path").attr("class","ma-line").datum(f).attr("d",p)}else a.selectAll(".ma-line").remove();var d=a.append("line").attr("y1",0).attr("y2",k).attr("class","crosshair crosshair-hidden"),v=a.append("rect").attr("class","pointer").attr("width",b).attr("height",k);W?v.on("click",function(){pt.event.stopPropagation(),h.call(n)}):v.on("mousemove",h).on("click",g),a.on("mouseleave",function(){d.classed("crosshair-hidden",!0),et()}),a.append("text").text(1<x.length?"".concat(E,". ").concat(r.key):r.key).attr("x",P).attr("y",T).attr("class","cell-label").on("click",g),X.per100k&&r.noPopulation&&a.append("text").text("No population data").attr("x",b/2).attr("y",k/2).attr("class","cell-label-nopop")}function h(){var t,e,n=pt.event,a=pt.mouse(this)[0],r=pt.bisectLeft(N,a),i=N[r-1],o=N[r],s=null==i||Math.abs(a-o)<Math.abs(a-i)?r:r-1,c=w[s],l=f.find(function(t){return t.date.getTime()===c.getTime()});if(l&&(l!==M||!A)){var u=Math.round(j(s)+O/2);d.attr("x1",u).attr("x2",u).classed("crosshair-hidden",!1),e=(t={value:l,field:m,evt:n,allowDrilldown:y&&!B}).value,tt(Tt({},t,{title:function(t){return t.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}(e.date),fieldLabels:Y}))}}function g(){y&&(ot(r.key),st("#viz"))}});var c=h(x[0].values).date,l=new Date(c);l.setDate(l.getDate()-a+1),s.append("text").attr("class","x-tick x-tick-start").attr("text-anchor","start").attr("x",0).attr("y",k+4).text(v(l)),s.append("text").attr("class","x-tick x-tick-end").attr("text-anchor","end").attr("x",b).attr("y",k+4).text(v(c))}var L=864e5;function tt(t){clearTimeout(x);var r=t.value,e=t.field,n=t.evt,a=t.allowDrilldown,i=t.title,o=t.subtitle,s=t.fieldLabels;M=r,A=!0;var c=n.pageX,l=n.pageY,u=n.clientY,f={left:"",right:"",top:"",bottom:"",transform:""},p=window.innerWidth,d=window.innerHeight,v=document.body.getBoundingClientRect().height,h=0<c-250,g=c+250<p,m=0<u-250,w=u-250<d;m?f.bottom="".concat(v-l+10,"px"):f.top="".concat(l+10,"px"),g?f.left="".concat(c+10,"px"):h?f.right="".concat(p-c+10,"px"):m||!w?(f.left=c,f.transform="translateX(-50%)",f.bottom="".concat(v-l+10,"px")):w&&(f.left=c,f.transform="translateX(-50%)",f.top="".concat(l+10,"px"));var y,b=B,k=b?"col-3":"col-2";y="tests"===X.field?[{key:"positive",color:"primary1",pct:r.positivePct},{key:"negative",color:"primary2",pct:r.negativePct},{key:"pending",pct:r.pendingPct},{key:"tests"},{key:"cases"},{key:"deaths"}]:"newTests"===X.field?[{key:"newPositive",color:"primary1",pct:r.newPositivePct},{key:"newNegative",color:"primary2",pct:r.newNegativePct},{key:"newTests"},{key:"newCases"},{key:"newDeaths"}]:["cases","deaths","newCases","newDeaths"].map(function(t){return{key:t,color:t===e?"primary1":null}}),X.per100k&&(y=y.map(function(t){return Tt({},t,{key:Z(t.key),suffix:" per 100k",formatter:z})}),null!=r.pop&&y.push({key:"pop"}));var P=y.map(function(t){var e,n=t.formatter||rt,a=r[t.key];return null==a?"":'\n        \t<div class="tooltip-dp-label '.concat(t.color||"",'">').concat(s[t.key],'</div>\n        \t<div class="tooltip-dp-val">').concat(n(a)).concat(t.suffix||"","</div>\n          ").concat(b?'\n            <div class="tooltip-dp-pct">\n              '.concat(null!=(e=t.pct)?"(".concat(it(e),")"):"","\n            </div>\n          "):"","\n        \t")}),T=a?'<div class="tooltip-drill"><span class="click">Click</span><span class="tap">Tap</span><span> to see counties</span></div>':"";wt()("#tooltip").addClass("shown").toggleClass("clickable",a).css(f).html("<div><h4>".concat(i,"</h4>\n        ").concat(o?"<h5>".concat(o,"</h5>"):"",'\n              <div class="tooltip-grid ').concat(k,'">\n                ').concat(P.join(""),"\n              </div>\n              ").concat(T,"</div>"))}function et(){x=setTimeout(d,W?500:50)}function d(){wt()("#tooltip").removeClass("shown"),A=!1}function v(t){return t.toLocaleString("default",{month:"short",day:"numeric"})}function nt(t,e){var n;return 1e6<=t?(t/=1e6,n="m"):1e3<=t&&(t/=1e3,n="k"),void 0!==e&&(t=parseFloat(t.toPrecision(e))),n?"".concat(t).concat(n):String(t)}var E=pt.format(",.1f"),_=pt.format(",.2f");function z(t){return(1<=t?E:_)(t)}var at=pt.format(",d");function rt(t){return at(t)}var it=pt.format(".1%");function ot(t){i.push(xt({},c.state,t))}function st(t){var e=document.querySelector(t);e&&e.scrollIntoView||window.scrollTo(0,0),e.scrollIntoView({behavior:"smooth",block:"start"})}var ct=ht()(function(){y&&p(y)},100);function lt(){return n=n||Promise.all([pt.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"),pt.csv("assets/fips-pop-cty.csv")]).then(function(t){var e,n,a,r,i,o=kt(t,2),s=o[0],c=o[1];e=s,n=c,a=pt.nest().key(function(t){return t.state}).entries(e),r={},i=j(n),a.forEach(function(t){var e=O(pt.nest().key(function(t){return t.county}).entries(t.values),i);r[t.key]={key:t.key,counties:e}}),l=r})}function ut(){a.then(function(){return p({groups:g,overview:m}),wt()(".back-to-states").removeClass("shown"),void d()})}function ft(r){Promise.all([a,lt()]).then(function(){return t=l[e=r],n=g.filter(function(t){return t.key===e}),a=n?n[0].values[0].fips:null,p({groups:t.counties,overview:n,isCounties:!0,stateFips:a}),wt()(".back-to-states").addClass("shown"),void d();var e,t,n,a})}window.addEventListener("resize",ct),a=a||Promise.all([pt.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv"),pt.csv("assets/fips-pop-sta.csv"),pt.json("https://covidtracking.com/api/v1/states/daily.json")]).then(function(t){var e=kt(t,3);o(e[0],e[1],e[2]);var n=g.slice(0).sort(function(t,e){return t.key.localeCompare(e.key)}).map(function(t){return'<option value="'.concat(t.key,'">').concat(t.key,"</option>")}).join("");wt()("#state-select").html('<option value="all" selected>All States</option>'.concat(n)),"all"!==X.state&&wt()("#state-select").val(X.state)}),"all"===X.state?(ut(),setTimeout(lt,200)):ft(X.state),wt()("#state-select").change(function(){ot(wt()(this).val())}),wt()(".back-to-states").click(function(){ot("all"),st("#viz-map")}),wt()("#field-select").change(function(){i.push(xt({},c.field,wt()(this).val()))}),wt()("#time-select").change(function(){i.push(xt({},c.time,wt()(this).val()))}),wt()("#tooltip").click(function(t){t.stopPropagation(),wt()(this).is(".clickable")&&M&&(ot(M.state||M.label),M.label||st("#viz"))}),wt()("#cb-use-log-scale").change(function(){var t=wt()(this).is(":checked");i.push(xt({},c.useLog,t?"1":"0"))}),wt()("#cb-per-100k").change(function(){var t=wt()(this).is(":checked");i.push(xt({},c.per100k,t?"1":"0"))}),wt()("#cb-consistent-y").change(function(){var t=wt()(this).is(":checked");i.push(xt({},c.consistentY,t?"1":"0"))}),wt()(document).on("click",function(){et()})}()}});
//# sourceMappingURL=main.f394728707c0ae7a8178.js.map