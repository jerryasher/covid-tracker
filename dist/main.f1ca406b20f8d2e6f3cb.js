!function(c){function t(t){for(var e,n,a=t[0],r=t[1],o=t[2],i=0,s=[];i<a.length;i++)n=a[i],Object.prototype.hasOwnProperty.call(u,n)&&u[n]&&s.push(u[n][0]),u[n]=0;for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(c[e]=r[e]);for(p&&p(t);s.length;)s.shift()();return f.push.apply(f,o||[]),l()}function l(){for(var t,e=0;e<f.length;e++){for(var n=f[e],a=!0,r=1;r<n.length;r++){var o=n[r];0!==u[o]&&(a=!1)}a&&(f.splice(e--,1),t=i(i.s=n[0]))}return t}var n={},u={0:0},f=[];function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return c[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=c,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="dist";var e=window.webpackJsonp=window.webpackJsonp||[],a=e.push.bind(e);e.push=t,e=e.slice();for(var r=0;r<e.length;r++)t(e[r]);var p=a;f.push(["Vtdi",1]),l()}({OMi8:function(t,e,n){},Vtdi:function(t,e,n){"use strict";n.r(e);var mt=n("VphZ"),a=n("KU4y"),gt=n.n(a),wt=n("Wwog"),r=n("DzJC"),yt=n.n(r),o=n("mVx/"),bt=n.n(o),i=n("ytg1"),kt=n.n(i),s=n("EVdn"),Pt=n.n(s),xt=n("LhCv"),Ot=n("0hfp");n("OMi8");function jt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);a=!0);}catch(t){r=!0,o=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function Ct(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){Dt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Dt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(){var t,e,U="ontouchstart"in document.documentElement;U&&Pt()(document.body).addClass("touch");var c=null,l=null,u=null,w=null,f={},W=null,F=null,R=null,X={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0},y=new Date(2020,0,21),b=null,Y=null,I=null,O=null,B=!1,V={cases:"Total Cases",deaths:"Total Deaths",tests:"Total Tests",positive:"Total Positive",pending:"Total Pending",negative:"Total Negative",newCases:"New Cases",newDeaths:"New Deaths",newTests:"New Tests",newPositive:"New Positive",newNegative:"New Negative",pop:"Est. Population"};Object.keys(V).forEach(function(t){V[Z(t)]=V[t]});var H=Tt({},V);Object.keys(H).forEach(function(t){0===t.indexOf("new")&&(H[t]="Avg ".concat(H[t].replace("New","Daily")))});var _=(Dt(t={newCases:!0,newDeaths:!0},Z("newCases"),!0),Dt(t,Z("newDeaths"),!0),t),J={"7d":"Last 7 days","14d":"Last 14 days","1mo":"Last 30 days","90d":"Last 90 days",all:"All-time"},v={"New York City":"36061","Kansas City":"29999"},a=(Dt(e={},"29999",505604),Dt(e,"29037",103525),Dt(e,"29095",386437),Dt(e,"29047",108919),Dt(e,"29165",48783),Dt(e,"36061",8336817),e),K={36005:"36061",36047:"36061",36081:"36061",36085:"36061"},p={state:"state",field:"field",time:"time",useLog:"log",per100k:"per100k",consistentY:"consistentY"},d={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0};function h(t){for(var e="?"===t[0]?t.substring(1):t,n=e?e.split("&"):[],a={},r=0;r<n.length;r++){var o=jt(n[r].split("=").map(decodeURIComponent),2),i=o[0],s=o[1];a[i]=s}return a}var n=new(function(){function n(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.history=t,this.history.listen(function(){e.parse(),"all"===X.state?vt():ht(X.state)})}var t,e,a;return t=n,(e=[{key:"parse",value:function(t){for(var e=0<arguments.length&&void 0!==t&&t,n=h(this.history.location.search),a=Object.keys(p),r=0;r<a.length;r++){var o=a[r],i=p[o],s=null!=n[i]?n[i]:d[o];if("boolean"==typeof d[o]&&"string"==typeof s&&(s="1"===s),X[o]!==s||e)switch(o){case"state":s=s.replace("+"," "),X.state=s,Pt()("#state-select").val(s);break;case"field":V[s]&&(X.field=s,Pt()("#field-select").val(s),(B="tests"===X.field||"newTests"===X.field)?(X.useLog=!1,Pt()("#cb-use-log-scale").prop("checked",!1),n[p.useLog]="0",Pt()(".testing-legend").show(),Pt()("#filter-use-log-scale").hide()):(Pt()(".testing-legend").hide(),Pt()("#filter-use-log-scale").show()),"newCases"===s||"newDeaths"===s?(Pt()(".ma-legend .legend-field-label").text(V[s]),Pt()(".ma-legend").show()):Pt()(".ma-legend").hide());break;case"time":X.time=s,Pt()("#time-select").val(s);break;case"useLog":X.useLog=s,Pt()("#cb-use-log-scale").prop("checked",s);break;case"per100k":X.per100k=s,Pt()("#cb-per-100k").prop("checked",s);break;case"consistentY":X.consistentY=s,Pt()("#cb-consistent-y").prop("checked",s)}}}},{key:"push",value:function(t){this._update("push",t)}},{key:"replace",value:function(t){this._update("replace",t)}},{key:"_update",value:function(t,e){var n,a,r=Tt({},h(this.history.location.search),{},e);this.history[t]({search:(n=r,(a=Object.keys(n).map(function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n[t]))}).join("&"))?"?".concat(a):"")})}}])&&Ct(t.prototype,e),a&&Ct(t,a),n}())(xt.a());function q(t){var e=["cases","deaths","newCases","newDeaths"];return t&&e.push("positive","negative","pending","tests","newPositive","newNegative","newTests"),e}function r(t){var n=Object.assign({},a);return t.forEach(function(t){var e=K[t.fips]||t.fips;n[e]=a[e]?a[e]:parseInt(t.pop)}),n}function m(t,p,e){var d=q(e);return t.forEach(function(u){for(var f=[],t=function(t){var e=u.values[t],n=jt(e.date.split("-"),3),a=n[0],r=n[1],o=n[2],i=e.fips;!i&&e.county&&(i=v[e.county]);var s=Tt({},e,{fips:i,date:new Date(Number(a),Number(r)-1,Number(o)),cases:Number(e.cases),deaths:Number(e.deaths),newCases:Number(e.newCases)});d.forEach(function(t){var e;s[t]=null==(e=s[t])?null:Number(e)}),f.push(s);var c=p[s.fips];if(c){var l=(s.pop=c)/1e5;d.forEach(function(t){"number"==typeof s[t]&&(s[Z(t)]=s[t]/l)})}else u.noPopulation=!0;(null===b||s.date.getTime()>b.getTime())&&(b=s.date)},e=0;e<u.values.length;e++)t(e);u.values=f}),t}function o(t,r,e){var n=q(e),a=n.concat(n.map(Z)),u=["newCases","newDeaths"];u=u.concat(u.map(Z));var f={},p=["date"].concat(a);p.forEach(function(t){return f[t]=[null,null]});var d=new Date(r[0]);d.setDate(d.getDate()-7);function v(t){return t.date.getTime()}return{groups:t.map(function(t){var e=t.values,o=[],i=r[0],n=g(r),s=new Date(d),c=kt()(e,{date:d},v),l={};u.forEach(function(t){l[t]=[]});for(var a=function(){var t=s.getTime()>=i.getTime(),n=e[c],a=n&&n.date.getTime()===s.getTime()?n:null,r={};u.forEach(function(t){var e=l[t];7===e.length&&e.shift(),a&&"number"==typeof a[t]?e.push(n[t]):e.push(0),r[z(t)]=mt.mean(e)}),t&&(a?o.push(Object.assign({},a,r)):o.push(Object.assign({date:new Date(s),fips:e[0].fips,pop:e[0].pop,state:e[0].state,county:e[0].county},r))),a&&c++,s.setDate(s.getDate()+1)};s.getTime()<=n.getTime();)a();return o.forEach(function(r){p.forEach(function(t){var e=f[t],n=r[t];if(null!=n&&(null===e[0]||n<e[0])&&(e[0]=n),null!=n&&(null===e[1]||n>e[1])&&(e[1]=n),_[t]){var a=r[z(t)];null!=a&&(null===e[1]||a>e[1])&&(e[1]=a)}})}),Tt({},t,{values:o})}),extents:f}}n.parse(!0);var k=Object(wt.a)(o),P=Object(wt.a)(o);function Z(t){return"".concat(t,"_p100k")}function z(t){return"".concat(t,"_ma")}function g(t){return t[t.length-1]}var x=0;function i(t){var e,n,a,r,o,i=(w=t).groups,s=t.overview,c=t.isCounties,l=t.stateFips,u=X.per100k?Z(X.field):X.field;e="7d"===X.time?7:"14d"===X.time?14:"1mo"===X.time?30:"90d"===X.time?90:(n=b,a=y,r=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),o=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()),Math.floor((o-r)/C));for(var f=[b],p=1;p<e;p++){var d=new Date(b);d.setDate(b.getDate()-p),f.unshift(d)}if(c&&B)return Pt()("#viz").hide(),void Pt()(".testing-data-unavailable").show();Pt()("#viz").show(),Pt()(".testing-data-unavailable").hide();var v=P(s,f,!0),h=k(i,f,!c),m={field:u,daysToShow:e,datesToShow:f,isCounties:c,stateFips:l};!function(t,e){var n=mt.select("#svg-overview"),a=n.node().getBoundingClientRect(),r=a.width,o=a.height,i=n.select("g.cell");i.selectAll("*").remove();var s=1024<=window.innerWidth,c=s?40:30,l=r-c-16,u=o-(s?20:14);i.attr("transform","translate(".concat(c,", 0)")),j(n,t,Tt({},e,{allowDrilldown:!1,chartWidth:l,chartHeight:u,cellLabelX:6,cellLabelY:0,barPad:3}))}(v,m),function(t,e){var n=e.field,a=e.daysToShow,r=mt.select("#grid");r.selectAll("*").remove(),r.attr("class",X.consistentY?"consistent-y":"");var o=t.groups.slice(0),i=1024<=window.innerWidth,s=i?30:25,c=i?40:35,l=i?250:150,u=Math.floor(window.innerWidth/(l+s)),f=Math.floor((window.innerWidth-s*(u+1))/u),p=o.length,d=Math.floor(f/2.15),v=i?40:30,h=i?20:14,m=window.innerWidth,g=10<a?1:2,w=f+s,y=d+h+c,b=Math.ceil(p/u),k=b*y,P=!e.isCounties;o.forEach(function(t){if(0===n.indexOf("new"))t.sortVal=mt.sum(t.values,function(t){return t[n]});else{var e=bt()(t.values,function(t){return null!=t[n]});t.sortVal=e?e[n]:-1}}),o.sort(function(t,e){return e.sortVal-t.sortVal}),r.attr("viewBox",[0,0,m,k]).selectAll("g.row").data(mt.range(b)).enter().append("g").attr("class","row").attr("transform",function(t){return"translate(".concat(v,", ").concat(t*y,")")}).each(function(e){var t=(e+1)*u>o.length?o.length%u:u,n=mt.range(t).map(function(t){return{row:e,col:t}});mt.select(this).selectAll("g.cell").data(n).enter().append("g").attr("class","cell").classed("cell-clickable",P&&!B).attr("transform",function(t){return"translate(".concat(t.col*w,", 0)")})}),j(r,Tt({},t,{groups:o}),Tt({},e,{allowDrilldown:P,chartWidth:f,chartHeight:d,cellLabelX:-20,cellLabelY:-10,barPad:g}))}(h,m);var g=++x;ct().then(function(){g===x&&function(t,e){var r=e.field,n=e.isCounties,a=e.stateFips,o=t.groups,i=!n,s=mt.select("#svg-map"),c=s.node().getBoundingClientRect(),l=c.width,u=c.height,f=l,p=u,d=mt.geoAlbersUsa().translate([f/2,p/2]).scale(f),v=mt.geoPath().projection(d),h=H[r],m=J[X.time];mt.select("#map-title").text("Map of ".concat(h,", ").concat(m));var g=s.select("#map-g").attr("width",f).attr("height",p),w=[];if(n){var y=String(Number(a));w=R.filter(function(t){var e=String(t.id);return y===e.substring(0,4===e.length?1:2)})}var b=n?W.filter(function(t){return t.id===Number(a)}):W,k=Boolean(b.length);mt.select("#map-no-data").classed("shown",!k),mt.select("#viz-map-header").style("opacity",k?1:0);var P=function(t,e){var s={},c=null!=t[0].values[0].tests,l=q(c);return t.forEach(function(t){var e=t.values;if(e.length){var n=e[0],a=n.fips,r=n.pop,o={fips:a,pop:r,label:t.key,cases:mt.sum(e,function(t){return t.newCases}),deaths:mt.sum(e,function(t){return t.newDeaths}),newCases:mt.mean(e,function(t){return t.newCases}),newDeaths:mt.mean(e,function(t){return t.newDeaths})};c&&(o.tests=mt.sum(e,function(t){return t.newTests}),o.positive=mt.sum(e,function(t){return t.newPositive}),o.positivePct=o.positive/o.tests,o.negative=mt.sum(e,function(t){return t.newNegative}),o.negativePct=o.negative/o.tests,o.pending=mt.sum(e,function(t){return t.newPending}),o.pendingPct=o.pending/o.tests,o.newTests=mt.mean(e,function(t){return t.newTests}),o.newPositive=mt.mean(e,function(t){return t.newPositive}),o.newPositivePct=o.newPositive/o.newTests,o.newNegative=mt.mean(e,function(t){return t.newNegative}),o.newNegativePct=o.newNegative/o.newTests);var i=r/1e5;l.forEach(function(t){"number"==typeof o[t]&&(o[Z(t)]=o[t]/i)}),s[Number(a)]=o}}),e.map(function(t){var e=K[t.id]||t.id,n=s[e];return Tt({id:t.id,feature:t},n)})}(o,n?w:b),x=[];P.forEach(function(t){var e=t[r];"number"==typeof e&&0<e&&x.push(e)}),0===x.length&&x.push(1);var O=mt.min(x),j=gt()().domain(x).range($);function C(t){var e=t[r];return null!=e&&0!==e?j(e):G}!function(t,e){mt.select("#map-legend").selectAll(".map-legend-item").data([0,e].concat(t)).join(function(t){var e=t.append("div").attr("class","map-legend-item");return e.append("div").classed("map-legend-item-label",!0),e},function(t){return t},function(t){return t.remove()}).each(function(t,e){Pt()(this).css("background-color",0===e?G:$[e-1])}).select(".map-legend-item-label").text(function(t){return at(t,2)})}(j.clusters(),O);var T=g.select("#map-states").selectAll(".map-state").data(n?b:P,function(t){return t.id}).join(function(t){return t.append("path").attr("opacity",0).attr("class","map-state map-feat")},function(t){return t},function(t){t.transition().duration(350).attr("opacity",0).remove()});T.attr("d",function(t){return v(t.feature)}).transition().duration(Q?0:350).attr("opacity",1).attr("fill",n?G:C);var D=g.select("#map-counties").selectAll(".map-county").data(n?P:[],function(t){return t.id}).join(function(t){return t.append("path").attr("opacity",0).attr("class",function(t){return"map-county map-county-".concat(t.id," map-feat")})},function(t){return t},function(t){t.transition().duration(350).attr("opacity",0).remove()}).attr("d",function(t){return v(t.feature)}).attr("fill",C);D.transition().duration(Q?0:350).attr("opacity",1),g.select("#map-state-borders").datum(F).attr("d",v).attr("opacity",n?0:1);var N=n?D:T;function L(t){var e,n,a=mt.event;t.label&&(n=(e={value:t,field:r,evt:a,allowDrilldown:i&&!B}).value,tt(Tt({},e,{title:n.label,subtitle:J[X.time],fieldLabels:H})))}var S=mt.select("#map-backdrop");S.attr("width",l).attr("height",u),S.on("click",function(){n&&rt("all")}),U?N.on("click",function(t){mt.event.stopPropagation(),L(t)}).on("mouseleave",function(){et()}):N.on("click",function(t){rt(i?t.label:"all")}).on("mouseenter",L).on("mouseleave",function(){et()});var M=Q?g:g.transition().duration(750);if(n&&b.length){var E=n?v.bounds(b[0]):null,A=E[1][0]-E[0][0],Y=E[1][1]-E[0][1],I=(E[0][0]+E[1][0])/2,V=(E[0][1]+E[1][1])/2,_=.9/Math.max(A/f,Y/p),z=[f/2-_*I,p/2-_*V];M.attr("transform","translate("+z+")scale("+_+")")}else M.attr("transform","translate(0)scale(1)");Q=!1}(h,m)})}var $=["#49006a","#672682","#874694","#a666a0","#c588a6","#e3aba6","#ffd09f"].reverse(),G="#999",Q=!0;function j(t,e,n){var y=n.field,a=n.daysToShow,b=n.datesToShow,k=n.allowDrilldown,P=n.chartWidth,x=n.chartHeight,O=n.cellLabelX,j=n.cellLabelY,r=n.barPad,C=e.groups,o=e.extents,i=X.useLog?"scaleLog":"scaleLinear",T=mt.scaleBand().domain(mt.range(b.length)).rangeRound([0,P]).paddingInner(r*a/P).paddingOuter(5*r/P),D=T.bandwidth(),N=b.map(function(t,e){return T(e)+D/2});function L(t){var e=[0,Math.max(t[1],X.per100k?.1:10)];if(X.useLog){var n=Math.max(t[0],0)||(X.per100k?.01:1);for(e[0]=1;e[0]>=n;)e[0]/=10}return mt[i]().domain(e).range([x,0]).nice()}function S(t){var e=t.domain()[1],n=4;for(X.useLog&&(n=X.per100k?3:e<100?1:e<1e3?2:e<1e4?3:4);5<t.ticks(n).length;)n--;return mt.axisLeft(t).ticks(n).tickSizeInner(-P).tickSizeOuter(0).tickFormat(function(t){return at(t).replace(/^0\./,".")})}var M=L(o[y]),E=S(M),s=t.selectAll("g.cell"),A=0;s.each(function(t,e){var n=this,a=mt.select(this),r=C[e];if(r){A++;var f=r.values;a.append("line").attr("class","baseline").attr("y1",x).attr("y2",x).attr("x2",P);var o,i=M,s=E;if(!X.consistentY){var c=mt.extent(f,function(t){return t[y]});if(_[y]){var l=z(y),u=mt.extent(f,function(t){return t[l]});c=mt.extent(c.concat(u))}s=S(i=L(c))}a.append("g").attr("transform","translate(0,0)").call(s),B?(o="newTests"===X.field?["newPositive","newNegative"]:["positive","negative"],X.per100k&&(o=o.map(Z))):o=[y];var p=mt.stack().keys(o)(f);if(a.selectAll("g.layer").data(p,function(t){return t.key}).enter().append("g").attr("class",function(t,e){return"layer layer-".concat(e+1," layer-").concat(t.key)}).selectAll(".bar").data(function(t){return t},function(t){return String(t.data.date.getTime())}).enter().append("rect").attr("class","bar").attr("width",D).attr("x",function(t,e){return T(e)}).attr("y",function(t){var e=Math.floor(i(t[1]));return Number.isNaN(e)?x:e}).attr("height",function(t){var e=Math.max(Math.ceil(x-i(t[1]-t[0])),0);return Number.isNaN(e)?0:e}),_[y]){var d=D/2,v=mt.line().x(function(t,e){return Math.round(T(e)+d)}).y(function(t){var e=Math.min(Math.floor(i(t[z(y)])),x);return Number.isNaN(e)?x:e}).curve(mt.curveMonotoneX);a.append("path").attr("class","ma-line").datum(f).attr("d",v)}else a.selectAll(".ma-line").remove();var h=a.append("line").attr("y1",0).attr("y2",x).attr("class","crosshair crosshair-hidden"),m=a.append("rect").attr("class","pointer").attr("width",P).attr("height",x);U?m.on("click",function(){mt.event.stopPropagation(),g.call(n)}):m.on("mousemove",g).on("click",w),a.on("mouseleave",function(){h.classed("crosshair-hidden",!0),et()}),a.append("text").text(1<C.length?"".concat(A,". ").concat(r.key):r.key).attr("x",O).attr("y",j).attr("class","cell-label").on("click",w),X.per100k&&r.noPopulation&&a.append("text").text("No population data").attr("x",P/2).attr("y",x/2).attr("class","cell-label-nopop")}function g(){var t,e,n=mt.event,a=mt.mouse(this)[0],r=mt.bisectLeft(N,a),o=N[r-1],i=N[r],s=null==o||Math.abs(a-i)<Math.abs(a-o)?r:r-1,c=b[s],l=f.find(function(t){return t.date.getTime()===c.getTime()});if(l&&(l!==Y||!I)){var u=Math.round(T(s)+D/2);h.attr("x1",u).attr("x2",u).classed("crosshair-hidden",!1),e=(t={value:l,field:y,evt:n,allowDrilldown:k&&!B}).value,tt(Tt({},t,{title:function(t){return t.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}(e.date),fieldLabels:V}))}}function w(){k&&(rt(r.key),ot("#viz"))}});var c=g(C[0].values).date,l=new Date(c);l.setDate(l.getDate()-a+1),s.append("text").attr("class","x-tick x-tick-start").attr("text-anchor","start").attr("x",0).attr("y",x+4).text(nt(l)),s.append("text").attr("class","x-tick x-tick-end").attr("text-anchor","end").attr("x",P).attr("y",x+4).text(nt(c))}var C=864e5;function tt(t){clearTimeout(O);var r=t.value,e=t.field,n=t.evt,a=t.allowDrilldown,o=t.title,i=t.subtitle,s=t.fieldLabels;Y=r,I=!0;var c=n.pageX,l=n.pageY,u=n.clientY,f={left:"",right:"",top:"",bottom:"",transform:""},p=window.innerWidth,d=window.innerHeight,v=document.body.getBoundingClientRect().height,h=0<c-250,m=c+250<p,g=0<u-250,w=u-250<d;g?f.bottom="".concat(v-l+10,"px"):f.top="".concat(l+10,"px"),m?f.left="".concat(c+10,"px"):h?f.right="".concat(p-c+10,"px"):g||!w?(f.left=c,f.transform="translateX(-50%)",f.bottom="".concat(v-l+10,"px")):w&&(f.left=c,f.transform="translateX(-50%)",f.top="".concat(l+10,"px"));var y,b=B,k=b?"col-3":"col-2";y="tests"===X.field?[{key:"positive",color:"primary1",pct:r.positivePct},{key:"negative",color:"primary2",pct:r.negativePct},{key:"pending",pct:r.pendingPct},{key:"tests"},{key:"cases"},{key:"deaths"}]:"newTests"===X.field?[{key:"newPositive",color:"primary1",pct:r.newPositivePct},{key:"newNegative",color:"primary2",pct:r.newNegativePct},{key:"newTests"},{key:"newCases"},{key:"newDeaths"}]:["cases","deaths","newCases","newDeaths"].map(function(t){return{key:t,color:t===e?"primary1":null}}),X.per100k&&(y=y.map(function(t){return Tt({},t,{key:Z(t.key),suffix:" per 100k",formatter:N})}),null!=r.pop&&y.push({key:"pop"}));var P=y.map(function(t){var e,n=t.formatter||S,a=r[t.key];return null==a?"":'\n        \t<div class="tooltip-dp-label '.concat(t.color||"",'">').concat(s[t.key],'</div>\n        \t<div class="tooltip-dp-val">').concat(n(a)).concat(t.suffix||"","</div>\n          ").concat(b?'\n            <div class="tooltip-dp-pct">\n              '.concat(null!=(e=t.pct)?"(".concat(M(e),")"):"","\n            </div>\n          "):"","\n        \t")}),x=a?'<div class="tooltip-drill"><span class="click">Click</span><span class="tap">Tap</span><span> to see counties</span></div>':"";Pt()("#tooltip").addClass("shown").toggleClass("clickable",a).css(f).html("<div><h4>".concat(o,"</h4>\n        ").concat(i?"<h5>".concat(i,"</h5>"):"",'\n              <div class="tooltip-grid ').concat(k,'">\n                ').concat(P.join(""),"\n              </div>\n              ").concat(x,"</div>"))}function et(){O=setTimeout(s,U?500:50)}function s(){Pt()("#tooltip").removeClass("shown"),I=!1}function nt(t){return t.toLocaleString("default",{month:"short",day:"numeric"})}function at(t,e){var n;return 1e6<=t?(t/=1e6,n="m"):1e3<=t&&(t/=1e3,n="k"),void 0!==e&&(t=parseFloat(t.toPrecision(e))),n?"".concat(t).concat(n):String(t)}var T=mt.format(",.1f"),D=mt.format(",.2f");function N(t){return(1<=t?T:D)(t)}var L=mt.format(",d");function S(t){return L(t)}var M=mt.format(".1%");function rt(t){n.push(Dt({},p.state,t))}function ot(t){var e=document.querySelector(t);e&&e.scrollIntoView||window.scrollTo(0,0),e.scrollIntoView({behavior:"smooth",block:"start"})}var E=0;function A(){E++,Pt()(".wrapper").addClass("loading")}function it(){--E<=0&&(Pt()(".wrapper").removeClass("loading"),E=0)}var st=yt()(function(){w&&i(w)},100);function ct(){return ct.promise||(ct.promise=mt.json("assets/us-counties.topojson").then(function(t){W=Ot.a(t,t.objects.states).features,F=Ot.b(t,t.objects.states,function(t,e){return t!==e}),R=Ot.a(t,t.objects.counties).features})),ct.promise}window.addEventListener("resize",st);var lt=Object(wt.a)(function(){return new Promise(function(n,t){mt.csv("assets/fips-pop-sta.csv").then(function(t){var e=r(t);n(e)}).catch(t)})}),ut=Object(wt.a)(function(){return new Promise(function(n,t){mt.csv("assets/fips-pop-cty.csv").then(function(t){var e=r(t);n(e)}).catch(t)})}),ft=Object(wt.a)(function(n){return new Promise(function(s,t){var e="all"===n?"all":"90d";Promise.all([mt.csv("https://raw.githubusercontent.com/schnerd/covid-tracker-data/master/data/state/".concat(e,".csv")),lt()]).then(function(t){var e,n,a,r=jt(t,2),o=r[0],i=r[1];e=o,n=i,a=m(mt.nest().key(function(t){return t.state}).entries(e),n,!0),c=[],a.forEach(function(t){"US"===t.key?(t.key="United States",u=[t]):(f[t.key]||(f[t.key]=t.values[0].fips),c.push(t))}),function t(e){if(!t.populated){t.populated=!0;var n=e.slice(0).sort(function(t,e){return t.key.localeCompare(e.key)}).map(function(t){return'<option value="'.concat(t.key,'">').concat(t.key,"</option>")}).join("");Pt()("#state-select").html('<option value="all" selected>All States</option>'.concat(n)),"all"!==X.state&&Pt()("#state-select").val(X.state)}}(c),s()}).catch(t)})}),pt=Object(wt.a)(function(a,r){return new Promise(function(c,n){dt().then(function(){var t="all"===r?"all":"90d",e=f[a];e?Promise.all([mt.csv("https://raw.githubusercontent.com/schnerd/covid-tracker-data/master/data/county/".concat(t,"/").concat(e,".csv")),ut()]).then(function(t){var e,n,a,r,o=jt(t,2),i=o[0],s=o[1];e=i,n=s,a=mt.nest().key(function(t){return t.state}).entries(e),r={},a.forEach(function(t){var e=m(mt.nest().key(function(t){return t.county}).entries(t.values),n,!1);r[t.key]={key:t.key,counties:e}}),l=r,c()}).catch(n):n(new Error("Could not find fips for state ".concat(a)))}).catch(n)})});function dt(){return ft(X.time)}function vt(){A(),dt().then(function(){return i({groups:c,overview:u}),Pt()(".back-to-states").removeClass("shown"),void s()}).finally(function(){it()})}function ht(r){A(),pt(r,X.time).then(function(){return t=l[e=r],n=c.filter(function(t){return t.key===e}),a=n?n[0].values[0].fips:null,i({groups:t.counties,overview:n,isCounties:!0,stateFips:a}),Pt()(".back-to-states").addClass("shown"),void s();var e,t,n,a}).finally(function(){it()})}"all"===X.state?vt():ht(X.state),Pt()("#state-select").change(function(){rt(Pt()(this).val())}),Pt()(".back-to-states").click(function(){rt("all"),ot("#viz-map")}),Pt()("#field-select").change(function(){n.push(Dt({},p.field,Pt()(this).val()))}),Pt()("#time-select").change(function(){n.push(Dt({},p.time,Pt()(this).val()))}),Pt()("#tooltip").click(function(t){t.stopPropagation(),Pt()(this).is(".clickable")&&Y&&(rt(Y.state||Y.label),Y.label||ot("#viz"))}),Pt()("#cb-use-log-scale").change(function(){var t=Pt()(this).is(":checked");n.push(Dt({},p.useLog,t?"1":"0"))}),Pt()("#cb-per-100k").change(function(){var t=Pt()(this).is(":checked");n.push(Dt({},p.per100k,t?"1":"0"))}),Pt()("#cb-consistent-y").change(function(){var t=Pt()(this).is(":checked");n.push(Dt({},p.consistentY,t?"1":"0"))}),Pt()(document).on("click",function(){et()})}()}});
//# sourceMappingURL=main.f1ca406b20f8d2e6f3cb.js.map