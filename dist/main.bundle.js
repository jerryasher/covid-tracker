!function(n){var a={};function r(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}r.m=n,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e){function ot(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function st(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){lt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function lt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(){var B="ontouchstart"in document.documentElement;B&&$(document.body).addClass("touch");var g=null,l=null,m=null,v=null,z=null,F=null,H=null,U={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0},h=new Date(2020,0,21),w=null,C=null,D=null,b=null,V=!1,S={cases:"Total Cases",deaths:"Total Deaths",tests:"Total Tests",positive:"Total Positive",pending:"Total Pending",negative:"Total Negative",newCases:"New Cases",newDeaths:"New Deaths",newTests:"New Tests",newPositive:"New Positive",newNegative:"New Negative",pop:"Est. Population"};Object.keys(S).forEach(function(t){S[J(t)]=S[t]});var K=ct({},S);Object.keys(K).forEach(function(t){t.startsWith("new")&&(K[t]="Avg ".concat(K[t].replace("New","Daily")))});var X={"7d":"Last 7 days","14d":"Last 14 days","1mo":"Last 30 days",all:"All-time"},y={"New York City":"36061","Kansas City":"29999"},e=lt({},"29999",491918),q={36005:"36061",36047:"36061",36081:"36061",36085:"36061"},o={state:"state",field:"field",time:"time",useLog:"log",per100k:"per100k",consistentY:"consistentY"},s={state:"all",field:"newCases",time:"14d",useLog:!1,per100k:!1,consistentY:!0};function c(t){for(var e="?"===t[0]?t.substring(1):t,n=e?e.split("&"):[],a={},r=0;r<n.length;r++){var i=ot(n[r].split("=").map(decodeURIComponent),2),o=i[0],s=i[1];a[o]=s}return a}var n=new(function(){function n(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(this.history=t).listen(function(){e.parse(),"all"===U.state?p():A(U.state)})}var t,e,a;return t=n,(e=[{key:"parse",value:function(){for(var t=c(this.history.location.search),e=Object.keys(o),n=0;n<e.length;n++){var a=e[n],r=o[a],i=null!=t[r]?t[r]:s[a];if("boolean"==typeof s[a]&&"string"==typeof i&&(i="1"===i),U[a]!==i)switch(a){case"state":U.state=i,$("#state-select").val(i);break;case"field":S[i]&&(U.field=i,$("#field-select").val(i),(V="tests"===U.field||"newTests"===U.field)?(U.useLog=!1,$("#cb-use-log-scale").prop("checked",!1),t[o.useLog]="0",$(".testing-legend").show(),$("#filter-use-log-scale").hide()):($(".testing-legend").hide(),$("#filter-use-log-scale").show()));break;case"time":U.time=i,$("#time-select").val(i);break;case"useLog":U.useLog=i,$("#cb-use-log-scale").prop("checked",i);break;case"per100k":U.per100k=i,$("#cb-per-100k").prop("checked",i);break;case"consistentY":U.consistentY=i,$("#cb-consistent-y").prop("checked",i)}}}},{key:"push",value:function(t){this._update("push",t)}},{key:"replace",value:function(t){this._update("replace",t)}},{key:"_update",value:function(t,e){var n,a,r=ct({},c(this.history.location.search),{},e);this.history[t]({search:(n=r,(a=Object.keys(n).map(function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n[t]))}).join("&"))?"?".concat(a):"")})}}])&&st(t.prototype,e),a&&st(t,a),n}())(window.History.createBrowserHistory());function G(t){var e=["cases","deaths","newCases","newDeaths"];return t&&e.push("positive","negative","pending","tests","newPositive","newNegative","newTests"),e}function a(t,e,n){var s,a=d3.nest().key(function(t){return t.state}).entries(t),r=(s={},n.forEach(function(t){if(t.date){var e=String(t.date).substring(0,4),n=String(t.date).substring(4,6),a=String(t.date).substring(6,8),r=t.fips,i={fips:r,date:new Date(Number(e),Number(n)-1,Number(a)),positive:Number(t.positive),negative:Number(t.negative),pending:Number(t.pending),tests:Number(t.total),newPositive:Number(t.positiveIncrease),newNegative:Number(t.negativeIncrease),newTests:Number(t.totalTestResultsIncrease)};s[r]||(s[r]={});var o=s[r];o[i.date.getTime()]&&console.error("Multiple rows for for same state fips/date",t),o[i.date.getTime()]=i}}),s),i=k(e);g=P(a,i,r);var o,c,l,u,d,f,p=ot((o=t,c=r,l=["cases","deaths"],u=["positive","negative","pending","tests","newPositive","newNegative","newTests"],d=d3.nest().key(function(t){return t.date}).entries(o).map(function(t){var e=t.values,n={fips:"00",date:e[0].date};return e.forEach(function(e){l.forEach(function(t){n[t]||(n[t]=0),n[t]+=Number(e[t])})}),n}),f={},Object.keys(c).forEach(function(t){var a=c[t];Object.keys(a).forEach(function(t){f[t]||(f[t]={});var e=a[t],n=f[t];u.forEach(function(t){n[t]||(n[t]=0),n[t]+=e[t]})})}),[[{key:"United States",values:d}],{"00":f}]),2),v=p[0],h=p[1];m=P(v,i,h)}function k(t){var n=Object.assign({},e);return t.forEach(function(t){var e=q[t.fips]||t.fips;null==n[e]&&(n[e]=0),n[e]+=parseInt(t.pop)}),n}function P(t,v,h){var g=G(!!h);return t.forEach(function(f){function t(t){var e=f.values[t-1],n=f.values[t],a=ot(n.date.split("-"),3),r=a[0],i=a[1],o=a[2],s=n.fips;!s&&n.county&&(s=y[n.county]);var c=ct({},n,{fips:s,date:new Date(Number(r),Number(i)-1,Number(o)),cases:Number(n.cases),deaths:Number(n.deaths)});e?(c.newCases=c.cases-e.cases,c.newDeaths=c.deaths-e.deaths):(c.newCases=c.cases,c.newDeaths=c.deaths),p.push(c);var l=((h?h[c.fips]:{})||{})[c.date.getTime()];l&&(c.positive=l.positive,c.positivePct=l.positive/l.tests,c.negative=l.negative,c.negativePct=l.negative/l.tests,c.pending=l.pending,c.pendingPct=l.pending/l.tests,c.tests=l.tests,c.newPositive=l.newPositive,c.newPositivePct=l.newPositive/l.newTests,c.newNegative=l.newNegative,c.newNegativePct=l.newNegative/l.newTests,c.newTests=l.newTests);var u=v[c.fips];if(u){var d=(c.pop=u)/1e5;g.forEach(function(t){"number"==typeof c[t]&&(c[J(t)]=c[t]/d)})}else f.noPopulation=!0;(null===w||c.date.getTime()>w.getTime())&&(w=c.date)}for(var p=[],e=0;e<f.values.length;e++)t(e);f.values=p}),t}function t(t,i,e){var n=G(e),o={},s=["date"].concat(n).concat(n.map(J));return s.forEach(function(t){return o[t]=[null,null]}),{groups:t.map(function(t){for(var e=t.values,n=[],a=0,r=0;r<i.length;r++){for(;e[a]&&e[a].date.getTime()<i[r].getTime();)a++;e[a]&&e[a].date.getTime()===i[r].getTime()&&n.push(ct({},e[a],{i:r}))}return n.forEach(function(n){s.forEach(function(t){var e=o[t];null!=n[t]&&(null===e[0]||n[t]<e[0])&&(o[t][0]=n[t]),null!=n[t]&&(null===e[1]||n[t]>e[1])&&(o[t][1]=n[t])})}),ct({},t,{values:n})}),extents:o}}n.parse();var T=I(t),N=I(t);function J(t){return"".concat(t,"_p100k")}var j=0;function r(t){var e,n=(v=t).groups,a=t.overview,r=t.isCounties,i=t.stateFips,o=U.per100k?J(U.field):U.field;e="7d"===U.time?7:"14d"===U.time?14:"1mo"===U.time?30:moment(w).diff(moment(h),"days");for(var s=[w],c=1;c<e;c++){var l=new Date(w);l.setDate(w.getDate()-c),s.unshift(l)}if(r&&V)return $("#viz").hide(),void $(".testing-data-unavailable").show();$("#viz").show(),$(".testing-data-unavailable").hide();var u=T(n,s,!r),d=N(a,s,!0),f={field:o,daysToShow:e,datesToShow:s,isCounties:r,stateFips:i};!function(t,e){var n=d3.select("#svg-overview"),a=n.node().getBoundingClientRect(),r=a.width,i=a.height,o=n.select("g.cell");o.selectAll("*").remove();var s=1024<=window.innerWidth,c=s?40:30,l=r-c-16,u=i-(s?20:14);o.attr("transform","translate(".concat(c,", 0)")),x(n,t,ct({},e,{allowDrilldown:!1,chartWidth:l,chartHeight:u,barPad:3}))}(d,f),function(t,e){var n=e.field,a=e.daysToShow,r=d3.select("#grid");r.selectAll("*").remove(),r.attr("class",U.consistentY?"consistent-y":"");var i=t.groups.slice(0),o=1024<=window.innerWidth,s=o?30:25,c=o?250:150,l=Math.floor(window.innerWidth/(c+s)),u=Math.floor((window.innerWidth-s*(l+1))/l),d=i.length,f=Math.floor(u/2.15),p=o?40:30,v=o?20:14,h=window.innerWidth,g=10<a?1:2,m=u+s,w=f+v+s,y=Math.ceil(d/l),b=y*w,k=!e.isCounties;i.forEach(function(t){if(n.startsWith("new"))t.sortVal=d3.sum(t.values,function(t){return t[n]});else{var e=_.findLast(t.values,function(t){return null!=t[n]});t.sortVal=e?e[n]:-1}}),i.sort(function(t,e){return e.sortVal-t.sortVal}),r.attr("viewBox",[0,0,h,b]).selectAll("g.row").data(d3.range(y)).enter().append("g").attr("class","row").attr("transform",function(t){return"translate(".concat(p,", ").concat(t*w,")")}).each(function(e){var t=(e+1)*l>i.length?i.length%l:l,n=d3.range(t).map(function(t){return{row:e,col:t}});d3.select(this).selectAll("g.cell").data(n).enter().append("g").attr("class","cell").classed("cell-clickable",k&&!V).attr("transform",function(t){return"translate(".concat(t.col*m,", 0)")})}),x(r,ct({},t,{groups:i}),ct({},e,{allowDrilldown:k,chartWidth:u,chartHeight:f,barPad:g}))}(u,f);var p=++j;(function(){Y=Y||d3.json("https://raw.githubusercontent.com/schnerd/covid-tracker/master/us-counties.topojson").then(function(t){z=window.topojson.feature(t,t.objects.states).features,F=window.topojson.mesh(t,t.objects.states,function(t,e){return t!==e}),H=window.topojson.feature(t,t.objects.counties).features});return Y})().then(function(){p===j&&function(t,e){var r=e.field,n=e.isCounties,a=e.stateFips,i=t.groups,o=!n,s=d3.select("#svg-map"),c=s.node().getBoundingClientRect(),l=c.width,u=c.height,d=l,f=u,p=d3.geoAlbersUsa().translate([d/2,f/2]).scale(d),v=d3.geoPath().projection(p),h=K[r],g=X[U.time];d3.select("#map-title").text("Map of ".concat(h,", ").concat(g));var m=s.select("#map-g").attr("width",d).attr("height",f),w=[];if(n){var y=String(Number(a));w=H.filter(function(t){var e=String(t.id);return y===e.substring(0,4===e.length?1:2)})}var b=n?z.filter(function(t){return t.id===Number(a)}):z,k=Boolean(b.length);d3.select("#map-no-data").classed("shown",!k),d3.select("#viz-map-header").style("opacity",k?1:0);var P=function(t,e){var s={},c=null!=t[0].values[0].tests,l=G(c);return t.forEach(function(t){var e=t.values,n=e[0],a=n.fips,r=n.pop,i={fips:a,pop:r,label:t.key,cases:d3.sum(e,function(t){return t.newCases}),deaths:d3.sum(e,function(t){return t.newDeaths}),newCases:d3.mean(e,function(t){return t.newCases}),newDeaths:d3.mean(e,function(t){return t.newDeaths})};c&&(i.tests=d3.sum(e,function(t){return t.newTests}),i.positive=d3.sum(e,function(t){return t.newPositive}),i.positivePct=i.positive/i.tests,i.negative=d3.sum(e,function(t){return t.newNegative}),i.negativePct=i.negative/i.tests,i.pending=d3.sum(e,function(t){return t.newPending}),i.pendingPct=i.pending/i.tests,i.newTests=d3.mean(e,function(t){return t.newTests}),i.newPositive=d3.mean(e,function(t){return t.newPositive}),i.newPositivePct=i.newPositive/i.newTests,i.newNegative=d3.mean(e,function(t){return t.newNegative}),i.newNegativePct=i.newNegative/i.newTests);var o=r/1e5;l.forEach(function(t){"number"==typeof i[t]&&(i[J(t)]=i[t]/o)}),s[Number(a)]=i}),e.map(function(t){var e=q[t.id]||t.id,n=s[e];return ct({id:t.id,feature:t},n)})}(i,n?w:b),T=[];P.forEach(function(t){var e=t[r];"number"==typeof e&&0<e&&T.push(e)}),0===T.length&&T.push(1);var N=d3.min(T),j=d3.scaleCluster().domain(T).range(Q);function x(t){var e=t[r];return null!=e&&0!==e?j(e):Z}!function(t,e){d3.select("#map-legend").selectAll(".map-legend-item").data([0,e].concat(t)).join(function(t){var e=t.append("div").attr("class","map-legend-item");return e.append("div").classed("map-legend-item-label",!0),e},function(t){return t},function(t){return t.remove()}).each(function(t,e){$(this).css("background-color",0===e?Z:Q[e-1])}).select(".map-legend-item-label").text(function(t){return at(t,2)})}(j.clusters(),N);var O=m.select("#map-states").selectAll(".map-state").data(n?b:P,function(t){return t.id}).join(function(t){return t.append("path").attr("opacity",0).attr("class","map-state map-feat")},function(t){return t},function(t){t.transition().duration(350).attr("opacity",0).remove()});O.attr("d",function(t){return v(t.feature)}).transition().duration(tt?0:350).attr("opacity",1).attr("fill",n?Z:x);var C=m.select("#map-counties").selectAll(".map-county").data(n?P:[],function(t){return t.id}).join(function(t){return t.append("path").attr("opacity",0).attr("class",function(t){return"map-county map-county-".concat(t.id," map-feat")})},function(t){return t},function(t){t.transition().duration(350).attr("opacity",0).remove()}).attr("d",function(t){return v(t.feature)}).attr("fill",x);C.transition().duration(tt?0:350).attr("opacity",1),m.select("#map-state-borders").datum(F).attr("d",v).attr("opacity",n?0:1);var D=n?C:O;function S(t){var e,n,a=d3.event;t.label&&(n=(e={value:t,field:r,evt:a,allowDrilldown:o&&!V}).value,et(ct({},e,{title:n.label,subtitle:X[U.time],fieldLabels:K})))}var E=d3.select("#map-backdrop");E.attr("width",l).attr("height",u),E.on("click",function(){n&&rt("all")}),B?D.on("click",function(t){d3.event.stopPropagation(),S(t)}).on("mouseleave",function(){nt()}):D.on("click",function(t){rt(o?t.label:"all")}).on("mouseenter",S).on("mouseleave",function(){nt()});var L=tt?m:m.transition().duration(750);if(n&&b.length){var A=n?v.bounds(b[0]):null,M=A[1][0]-A[0][0],I=A[1][1]-A[0][1],Y=(A[0][0]+A[1][0])/2,_=(A[0][1]+A[1][1])/2,W=.9/Math.max(M/d,I/f),R=[d/2-W*Y,f/2-W*_];L.attr("transform","translate("+R+")scale("+W+")")}else L.attr("transform","translate(0)scale(1)");tt=!1}(u,f)})}var Q=["#49006a","#672682","#874694","#a666a0","#c588a6","#e3aba6","#ffd09f"].reverse(),Z="#999",tt=!0;function x(t,e,n){var h=n.field,a=n.daysToShow,g=n.datesToShow,m=n.allowDrilldown,w=n.chartWidth,y=n.chartHeight,r=n.barPad,b=e.groups,i=e.extents,o=U.useLog?"scaleLog":"scaleLinear",k=d3.scaleBand().domain(g).rangeRound([0,w]).paddingInner(r*a/w).paddingOuter(5*r/w),P=k.bandwidth(),T=g.map(function(t){return k(t)+P/2});function N(t){var e=[0,Math.max(t[1],U.per100k?.1:10)];if(U.useLog){var n=Math.max(t[0],0)||(U.per100k?.01:1);for(e[0]=1;e[0]>=n;)e[0]/=10}return d3[o]().domain(e).range([y,0]).nice()}function j(t){var e=t.domain()[1],n=4;for(U.useLog&&(n=U.per100k?3:e<100?1:e<1e3?2:e<1e4?3:4);5<t.ticks(n).length;)n--;return d3.axisLeft(t).ticks(n).tickSizeInner(-w).tickSizeOuter(0).tickFormat(function(t){return at(t).replace(/^0\./,".")})}var x=N(i[h]),$=j(x),s=t.selectAll("g.cell"),O=0;s.each(function(t,e){var n=this,a=d3.select(this),r=b[e];if(r){O++;var d=r.values;a.append("line").attr("class","baseline").attr("y1",y).attr("y2",y).attr("x2",w);var i,o=x,s=$;if(!U.consistentY){var c=d3.extent(d,function(t){return t[h]});s=j(o=N(c))}a.append("g").attr("transform","translate(0,0)").call(s),V?(i="newTests"===U.field?["newPositive","newNegative"]:["positive","negative"],U.per100k&&(i=i.map(J))):i=[h];var l=d3.stack().keys(i)(d);a.selectAll("g.layer").data(l,function(t){return t.key}).enter().append("g").attr("class",function(t,e){return"layer layer-".concat(e+1," layer-").concat(t.key)}).selectAll(".bar").data(function(t){return t},function(t){return String(t.data.date.getTime())}).enter().append("rect").attr("class","bar").attr("width",P).attr("x",function(t){return k(t.data.date)}).attr("y",function(t){var e=Math.floor(o(t[1]));return Number.isNaN(e)?y:e}).attr("height",function(t){var e=Math.max(Math.ceil(y-o(t[1]-t[0])),0);return Number.isNaN(e)?0:e});var f=a.append("line").attr("y1",0).attr("y2",y).attr("class","crosshair crosshair-hidden"),u=a.append("rect").attr("class","pointer").attr("width",w).attr("height",y);B?u.on("click",function(){d3.event.stopPropagation(),p.call(n)}):u.on("mousemove",p).on("click",v),a.on("mouseleave",function(){f.classed("crosshair-hidden",!0),nt()}),a.append("text").text(1<b.length?"".concat(O,". ").concat(r.key):r.key).attr("x",6).attr("y",14).attr("class","cell-label").on("click",v),U.per100k&&r.noPopulation&&a.append("text").text("No population data").attr("x",w/2).attr("y",y/2).attr("class","cell-label-nopop")}function p(){var t,e,n=d3.event,a=d3.mouse(this)[0],r=d3.bisectLeft(T,a),i=T[r-1],o=T[r],s=null==i||Math.abs(a-o)<Math.abs(a-i)?r:r-1,c=g[s],l=d.find(function(t){return t.date.getTime()===c.getTime()});if(l&&(l!==C||!D)){var u=Math.round(k(c)+P/2);f.attr("x1",u).attr("x2",u).classed("crosshair-hidden",!1),e=(t={value:l,field:h,evt:n,allowDrilldown:m&&!V}).value,et(ct({},t,{title:function(t){return t.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}(e.date),fieldLabels:S}))}}function v(){m&&(window.scrollTo(0,0),rt(r.key))}});var c,l=(c=b[0].values)[c.length-1].date,u=new Date(l);u.setDate(u.getDate()-a+1),s.append("text").attr("class","x-tick x-tick-start").attr("text-anchor","start").attr("x",0).attr("y",y+4).text(d(u)),s.append("text").attr("class","x-tick x-tick-end").attr("text-anchor","end").attr("x",w).attr("y",y+4).text(d(l))}function et(t){clearTimeout(b);var r=t.value,e=t.field,n=t.evt,a=t.allowDrilldown,i=t.title,o=t.subtitle,s=t.fieldLabels;C=r,D=!0;var c=n.pageX,l=n.pageY,u=n.clientY,d={left:"",right:"",top:"",bottom:""},f=window.innerWidth,p=window.innerHeight;if(f<c+250?d.right="".concat(f-c+10,"px"):d.left="".concat(c+10,"px"),p<u+250){var v=document.body.getBoundingClientRect().height;d.bottom="".concat(v-l+10,"px")}else d.top="".concat(l+10,"px");var h,g=V,m=g?"col-3":"col-2";h="tests"===U.field?[{key:"positive",color:"primary1",pct:r.positivePct},{key:"negative",color:"primary2",pct:r.negativePct},{key:"pending",pct:r.pendingPct},{key:"tests"},{key:"cases"},{key:"deaths"}]:"newTests"===U.field?[{key:"newPositive",color:"primary1",pct:r.newPositivePct},{key:"newNegative",color:"primary2",pct:r.newNegativePct},{key:"newTests"},{key:"newCases"},{key:"newDeaths"}]:["cases","deaths","newCases","newDeaths"].map(function(t){return{key:t,color:t===e?"primary1":null}}),U.per100k&&(h=h.map(function(t){return ct({},t,{key:J(t.key),suffix:" per 100k",formatter:O})}),null!=r.pop&&h.push({key:"pop"}));var w=h.map(function(t){var e,n=t.formatter||E,a=r[t.key];return null==a?"":'\n        \t<div class="tooltip-dp-label '.concat(t.color||"",'">').concat(s[t.key],'</div>\n        \t<div class="tooltip-dp-val">').concat(n(a)).concat(t.suffix||"","</div>\n          ").concat(g?'\n            <div class="tooltip-dp-pct">\n              '.concat(null!=(e=t.pct)?"(".concat(L(e),")"):"","\n            </div>\n          "):"","\n        \t")}),y=a?'<div class="tooltip-drill"><span class="click">Click</span><span class="tap">Tap</span><span> to see counties</span></div>':"";$("#tooltip").addClass("shown").toggleClass("clickable",a).css(d).html("<div><h4>".concat(i,"</h4>\n        ").concat(o?"<h5>".concat(o,"</h5>"):"",'\n              <div class="tooltip-grid ').concat(m,'">\n                ').concat(w.join(""),"\n              </div>\n              ").concat(y,"</div>"))}function nt(){b=setTimeout(i,50)}function i(){$("#tooltip").removeClass("shown"),D=!1}function d(t){return t.toLocaleString("default",{month:"short",day:"numeric"})}function at(t,e){var n;return 1e6<=t?(t/=1e6,n="m"):1e3<=t&&(t/=1e3,n="k"),void 0!==e&&(t=parseFloat(t.toPrecision(e))),n?"".concat(t).concat(n):String(t)}var u=d3.format(",.1f");function O(t){return u(t)}var f=d3.format(",d");function E(t){return f(t)}var L=d3.format(".1%");function rt(t){n.push(lt({},o.state,t))}function p(){r({groups:g,overview:m}),$(".back-to-states").removeClass("shown"),i()}function A(e){var t=l[e],n=g.filter(function(t){return t.key===e}),a=n?n[0].values[0].fips:null;r({groups:t.counties,overview:n,isCounties:!0,stateFips:a}),$(".back-to-states").addClass("shown"),i()}function M(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function I(n,a){var r;void 0===a&&(a=M);var i,o=[],s=!1;return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return s&&r===this&&a(t,o)||(i=n.apply(this,t),s=!0,r=this,o=t),i}}var Y,W=_.throttle(function(){v&&r(v)},100);function R(){return Promise.all([d3.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"),d3.csv("https://raw.githubusercontent.com/schnerd/covid-tracker/master/fips-pop-cty.csv")]).then(function(t){var e,n,a,r,i,o=ot(t,2),s=o[0],c=o[1];e=s,n=c,a=d3.nest().key(function(t){return t.state}).entries(e),r={},i=k(n),a.forEach(function(t){var e=P(d3.nest().key(function(t){return t.county}).entries(t.values),i);r[t.key]={key:t.key,counties:e}}),l=r})}window.addEventListener("resize",W);var it=Promise.all([d3.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv"),d3.csv("https://raw.githubusercontent.com/schnerd/covid-tracker/master/fips-pop-sta.csv"),d3.json("https://covidtracking.com/api/states/daily")]).then(function(t){var e=ot(t,3);a(e[0],e[1],e[2]);var n=g.slice(0).sort(function(t,e){return t.key.localeCompare(e.key)}).map(function(t){return'<option value="'.concat(t.key,'">').concat(t.key,"</option>")}).join("");$("#state-select").html('<option value="all" selected>All States</option>'.concat(n)),"all"!==U.state&&$("#state-select").val(U.state)});"all"===U.state?(it.then(function(){return p()}),setTimeout(R,200)):Promise.all([it,R()]).then(function(){return A(U.state)}),$("#state-select").change(function(){rt($(this).val())}),$(".back-to-states").click(function(){rt("all"),window.scrollTo(0,0)}),$("#field-select").change(function(){n.push(lt({},o.field,$(this).val()))}),$("#time-select").change(function(){n.push(lt({},o.time,$(this).val()))}),$("#tooltip").click(function(){$(this).is(".clickable")&&C&&(rt(C.state||C.label),C.label||window.scrollTo(0,0))}),$("#cb-use-log-scale").change(function(){var t=$(this).is(":checked");n.push(lt({},o.useLog,t?"1":"0"))}),$("#cb-per-100k").change(function(){var t=$(this).is(":checked");n.push(lt({},o.per100k,t?"1":"0"))}),$("#cb-consistent-y").change(function(){var t=$(this).is(":checked");n.push(lt({},o.consistentY,t?"1":"0"))}),$(document).on("click",function(){nt()})}()}]);